var itemsConverter=(function(document){'use strict';var options={blank:{name:'blank',type:'png',width:100,height:50,fillColor:'#CCCCCC'},crimes_medium:{name:'crimes_medium',type:'png',width:60,height:30},crimes_blank:{name:'crimes_blank',type:'png',width:60,height:30,fillColor:'#BDBDAE'},large:{name:'large',type:'png',width:100,height:50},large_bg_gray:{name:'large',type:'jpg',width:100,height:50,bgColor:'#CCCCCC'},large_dark:{name:'large_dark',type:'png',width:100,height:50},medium:{name:'medium',type:'png',width:60,height:30},small:{name:'small',type:'png',width:38,height:19}};var itemImageClass='item-converted';var itemGlowClass='item-glow';var hex2rgb=function(hex,opacity){hex=(hex+'').trim();opacity=opacity||1;var rgb=null;var match=hex.match(/^#?(([0-9a-zA-Z]{3}){1,3})$/);if(!match){return null;}
rgb={};hex=match[1];if(hex.length===6){rgb.r=parseInt(hex.substring(0,2),16);rgb.g=parseInt(hex.substring(2,4),16);rgb.b=parseInt(hex.substring(4,6),16);}
else if(hex.length===3){rgb.r=parseInt(hex.substring(0,1)+hex.substring(0,1),16);rgb.g=parseInt(hex.substring(1,2)+hex.substring(1,2),16);rgb.b=parseInt(hex.substring(2,3)+hex.substring(2,3),16);}
rgb.css='rgb'+(opacity?'a':'')+'(';rgb.css+=rgb.r+','+rgb.g+','+rgb.b;rgb.css+=(opacity?','+opacity:'')+')';return rgb;};var isCanvasSupported=function(){var elem=document.createElement('canvas');return!!(elem.getContext&&elem.getContext('2d'));};var sizeIsValid=function(size){return options[size]!==undefined;};var getItemAttributes=function(item){var mainItemAttributes={src:{target:'src',value:item.getAttribute('src'),required:false},title:{target:'title',value:item.getAttribute('title'),required:true},id:{target:'id',value:item.getAttribute('id'),required:true},role:{target:'role',value:item.getAttribute('role')||'img',required:true},alt:{target:'aria-label',value:item.getAttribute('alt')||'',required:true},class:{target:'class',value:item.getAttribute('class')||'',required:false},'data-color':{target:'color',value:item.getAttribute('data-color'),required:false},'data-opacity':{target:'opacity',value:item.getAttribute('data-opacity'),required:false},'data-overlay':{target:'overlay',value:item.getAttribute('data-overlay'),required:false},'data-size':{target:'size',value:item.getAttribute('data-size')||options.large.name,required:false},'data-shadowBlur':{target:'shadowBlur',value:item.getAttribute('data-shadowBlur')||9,required:false},'data-offsetX':{target:'offsetX',value:item.getAttribute('data-offsetX')||0,required:false},'data-offsetY':{target:'offsetY',value:item.getAttribute('data-offsetY')||0,required:false}};var src=item.getAttribute('src');var title=item.getAttribute('title');var id=item.getAttribute('id');var role=item.getAttribute('role')||'img';var alt=item.getAttribute('alt')||'';var color=item.getAttribute('data-color');var opacity=item.getAttribute('data-opacity');var overlay=item.getAttribute('data-overlay');var size=item.getAttribute('data-size')||options.large.name;var cssClasses=item.getAttribute('class')||'';var shadowBlur=item.getAttribute('data-shadowBlur')||9;var offsetX=item.getAttribute('data-offsetX')||0;var offsetY=item.getAttribute('data-offsetY')||0;var imageOffsetWidth=offsetX?offsetX*2:0;var imageOffsetHeight=offsetY?offsetY*2:0;var requiredItemAttributes=[];for(var attrName of item.getAttributeNames()){var attrValue=item.getAttribute(attrName);console.log(attrName,attrValue);if(mainItemAttributes[attrName]&&mainItemAttributes[attrName].required){}
else{}}
return{src:src,title:title,id:id,role:role,alt:alt,color:color,opacity:opacity,overlay:overlay,size:size,cssClasses:cssClasses,shadowBlur:shadowBlur,offsetX:offsetX,offsetY:offsetY,imageOffsetWidth:imageOffsetWidth,imageOffsetHeight:imageOffsetHeight}};var setFillColor=function(imgData,itemOptions){var pix=imgData.data;var color=hex2rgb(itemOptions.fillColor);for(var index=0,length=pix.length;index<length;index+=4){pix[index]=color.r;pix[index+1]=color.g;pix[index+2]=color.b;}
return imgData;};var setGlow=function(imgData,itemAttributes){var pix=imgData.data;var r=hex2rgb(itemAttributes.overlay).r;var g=hex2rgb(itemAttributes.overlay).g;var b=hex2rgb(itemAttributes.overlay).b;for(var index=0,length=pix.length;index<length;index+=4){pix[index]=(pix[index]<128)?2*r*pix[index]/255:255-2*(255-r)*(255-pix[index])/255;pix[index+1]=(pix[index+1]<128)?2*g*pix[index+1]/255:255-2*(255-g)*(255-pix[index+1])/255;pix[index+2]=(pix[index+2]<128)?2*b*pix[index+2]/255:255-2*(255-b)*(255-pix[index+2])/255;}
return imgData;};var setBackgroundColor=function(canvas,itemOptions){canvas.style.background=itemOptions.bgColor;return canvas;};var init=function(settings){return false;var selector=settings.selector||undefined;var images=document.querySelectorAll(selector);if(!isCanvasSupported()||!images.length){return false;}
var itemAttributes,itemOptions,canvas,ctx,imgData;var isFillColor=false,isGlow=false,isBackgroundColor=false;var convert=function(image){itemAttributes=getItemAttributes(image);if(!sizeIsValid(itemAttributes.size)){return null;}
itemOptions=options[itemAttributes.size];isFillColor=!!itemOptions.fillColor;isBackgroundColor=!!itemOptions.bgColor;isGlow=itemAttributes.color&&itemAttributes.overlay&&itemAttributes.opacity;canvas=document.createElement('canvas');ctx=canvas.getContext('2d');canvas.setAttribute('role',itemAttributes.role);if(itemAttributes.alt){canvas.setAttribute('aria-label',itemAttributes.alt);}
if(itemAttributes.title){canvas.title=itemAttributes.title;}
if(itemAttributes.id){canvas.id=itemAttributes.id;}
canvas.width=itemOptions.width+itemAttributes.imageOffsetWidth;canvas.height=itemOptions.height+itemAttributes.imageOffsetHeight;canvas.className=[itemAttributes.cssClasses,itemImageClass].join(' ').trim();if(isGlow){ctx.shadowBlur=itemAttributes.shadowBlur;ctx.shadowColor=hex2rgb(itemAttributes.color,itemAttributes.opacity).css;canvas.className=[canvas.className,itemGlowClass].join(' ').trim();}
ctx.drawImage(image,0,0,image.naturalWidth,image.naturalHeight,itemAttributes.offsetX,itemAttributes.offsetY,itemOptions.width,itemOptions.height);imgData=ctx.getImageData(0,0,canvas.width,canvas.height);imgData=(isFillColor)?setFillColor(imgData,itemOptions):imgData;imgData=(isGlow)?setGlow(imgData,itemAttributes):imgData;canvas=(isBackgroundColor)?setBackgroundColor(canvas,itemOptions):canvas;ctx.putImageData(imgData,0,0);image.parentNode&&image.parentNode.replaceChild(canvas,image);console.log('Image is converted: ',image,canvas);image.remove();return canvas;};[].forEach.call(images,function(image){if(image.getAttribute('data-size')){image.style.opacity=0;}
var lazyImage=new Image();lazyImage.onload=function(){convert(image);this.remove();};lazyImage.onerror=function(){console.error('Image not found: '+image);};lazyImage.src=image.getAttribute('src');});return true;};return{init:init};})(document);