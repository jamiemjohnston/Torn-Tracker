var EDITOR_CONTENT_PREFIX='EditorContent-';var tutorialSwitchInited=false;function initOverlay(){}
function updateOverlayPosition(){}
function isDesktop(){var mobile=(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));return!mobile;}
function isTouchDevice(){return 'ontouchstart'in window;}
function getClickEventType(){return(document.ontouchstart!==null)?'click':'touchstart';}
function isNumber(value){return!isNaN(parseFloat(value))&&isFinite(value);}
function isIntNumber(value){return isNumber(value)&&(value%1==0);}
function isPrettyNumber(value,useDot){var regex=(useDot==undefined||useDot==true)?/^(\d+|\d{1,3}(,\d{3})*)(\.\d+)?$/:/^(\d+|\d{1,3}(,\d{3})*)$/;return regex.test(value);}
function parsePrettyNumberToFloat(value){return parseFloat(value.replace(',',''));}
function parsePrettyNumberToInt(value){return parseInt(value.toString().replace(/,/g,''));}
var MOBILE='mobile';var TABLET='tablet';var DESKTOP='desktop';var maxTabletSize=1000;var minTabletSize=600;var minDesktopSize=1001;function isDesktopMedia(){return getMediaQueryName()==DESKTOP;}
function isTabletMedia(){return getMediaQueryName()==TABLET;}
function isMobileMedia(){return getMediaQueryName()==MOBILE;}
function aboveMaxTabletSize(useStrict){var strict=useStrict||false;return(strict)?getBrowserWidth()>maxTabletSize:getBrowserWidth()>=maxTabletSize;}
function belowMaxTabletSize(useStrict){var strict=useStrict||false;return(strict)?getBrowserWidth()<maxTabletSize:getBrowserWidth()<=maxTabletSize;}
function aboveMinTabletSize(useStrict){var strict=useStrict||false;return(strict)?getBrowserWidth()>minTabletSize:getBrowserWidth()>=minTabletSize;}
function belowMinTabletSize(useStrict){var strict=useStrict||false;return(strict)?getBrowserWidth()<minTabletSize:getBrowserWidth()<=minTabletSize;}
function getMediaQueryName(){return window.getComputedStyle(document.querySelector('body'),':before').content.replace(/"/g,'');}
function getMediaQuery(isNotForMediaChecking){var media=getMediaQueryName();var result=minDesktopSize;switch(media){case TABLET:result=maxTabletSize;break;case MOBILE:result=minTabletSize;break;}
if(!$('body').hasClass('r')&&!isNotForMediaChecking){result=1200;}
return result;}
function getBrowserWidth(isNotForMediaChecking){return getMediaQuery(isNotForMediaChecking);}
function getBrowserWidthOld(isNotForMediaChecking){var browserWidth=($.browser.webkit)?document.body.clientWidth:($.browser.msie&&!window.innerWidth)?document.body.clientWidth:window.innerWidth;if(screen.width<browserWidth){browserWidth=screen.width;}
if(!$('body').hasClass('r')&&!isNotForMediaChecking){browserWidth=1200;}
return browserWidth;}
function getUrlParam(name){var results=new RegExp('[\?&]'+name+'=([^&#]*)').exec(window.location.href);return results?results[1]:null;}
function isolatedNativeScroll(selector){$('body').on('mousewheel DOMMouseScroll',selector,function(e){var originalEvent=e.originalEvent;var delta=originalEvent.wheelDelta||-originalEvent.detail;this.scrollTop+=(delta<0?1:-1);e.preventDefault();});}
function flexdestroy(selector){$(selector).each(function(){var el=$(this);var elClean=el.clone();elClean.find('.flex-viewport').children().unwrap();elClean.find('.clone, .flex-direction-nav, .flex-control-nav').remove().end().find('*').removeAttr('style').removeClass(function(index,css){return(css.match(/\bflex\S+/g)||[]).join(' ');});elClean.insertBefore(el);el.remove();});}
function sortableScrollHack(event,ui){var $window=$(window);var windowHeight=$window.height();var currentScrollTop=$window.scrollTop(),topHelper=ui.position.top,delta=topHelper-currentScrollTop;var y=event.clientY,minDiff=100,scrollDeltaCoef=0.8;if(y<minDiff||windowHeight-y<minDiff){setTimeout(function(){$window.scrollTop((currentScrollTop+delta*scrollDeltaCoef));},5);}}
function sortingItemsListAndSavingPosition(listClass,cookieName,handleClass){if(listClass===undefined)
listClass='sortable-list';var $list=$('.'+listClass);var handle='.draggable-wrap'||handleClass;if(cookieName===undefined)
cookieName=$list.attr('cookie-name');function setItemsListCookie(){if(!cookieName)
return;var $listRows=$('.'+listClass+' > li');var $listData={items:[]};$listRows.each(function(){$listData.items.push({id:$(this).attr('id').replace('#item','')});});if(!$.cookie(cookieName)){$.cookie(cookieName,JSON.stringify($listData),{expires:18262});}else{$.cookie(cookieName,JSON.stringify($listData));}}
function getItemsListCookie(){if(!cookieName)
return;if($.cookie(cookieName)){var cookies=$.parseJSON($.cookie(cookieName));if(cookies){$(cookies.items).each(function(index){var item=cookies.items[index];$('#item'+item.id).appendTo($list);});}}}
$list.sortable({helper:'clone',containment:"parent",tolerance:"pointer",handle:handle,scroll:true,stop:function(event,ui){setItemsListCookie();},sort:function(event,ui){sortableScrollHack(event,ui);}});getItemsListCookie();}
function clearTinyMCEContent(selector,textAreaId){selector.click(function(){tinymce.get(textAreaId).setContent('');});}
function toggleTopPageLinks(){$('.links-top-wrap.activated').live('click',function(){var $el=$(this);$el.toggleClass('arrow-act');});}
function initializePagination(visibleElementsCount,activeFlag,className,paginationSelector){var paginationWrapper=paginationSelector||$('.pagination');var $pageNumber=paginationWrapper.find('.page-number').removeClass('page-show');if($pageNumber.size()===0){$('.pagination-left, .pagination-right').hide();}
paginationWrapper.find('.page-number.first, .page-number.last').addClass('page-show');var paginationCount=visibleElementsCount/2|0;var paginationElementSelector='.'+className+'.'+activeFlag;var $paginationElementPrev=paginationWrapper.find(paginationElementSelector);var $paginationElementNext=paginationWrapper.find(paginationElementSelector);for(var i=0;i<paginationCount;i++){$paginationElementNext=$paginationElementNext.next();if($paginationElementNext.hasClass('last')||!$paginationElementNext.hasClass(className)){$paginationElementPrev=$paginationElementPrev.prev();$paginationElementPrev.addClass('page-show');}else{$paginationElementNext.addClass('page-show');}
$paginationElementPrev=$paginationElementPrev.prev();if($paginationElementPrev.hasClass('first')||!$paginationElementPrev.hasClass(className)){$paginationElementNext=$paginationElementNext.next();$paginationElementNext.addClass('page-show');}else{$paginationElementPrev.addClass('page-show');}}
$(paginationElementSelector).addClass('page-show');$(paginationElementSelector).live('click',function(event){event.preventDefault();});$('.pagination a.disable').live('click',function(event){event.preventDefault();});var pagination_wrap=paginationSelector||$('.pagination');var lastPageSelector=pagination_wrap.find('.page-number.last');var firstPageSelector=pagination_wrap.find('.page-number.first');var prevLast=null;var nextFirst=null;var fl=false;var ff=false;pagination_wrap.find('.page-number:not(.first, .last)').each(function(){if(lastPageSelector.find('.page-nb').length){if($(this).is(':visible')&&$(this).find('.page-nb').text()==lastPageSelector.first().find('.page-nb').text()){fl=true;}}
if(firstPageSelector.find('.page-nb').length){if($(this).is(':visible')&&$(this).find('.page-nb').text()==firstPageSelector.first().find('.page-nb').text()){ff=true;}}});if(fl){lastPageSelector.hide();lastPageSelector.prev('.points').hide();}else{lastPageSelector.show();if(lastPageSelector.first().find('.page-nb').text()!=+lastPageSelector.first().prevAll('.page-number.page-show').first().text()+1){lastPageSelector.prev('.points').show();}else{lastPageSelector.prev('.points').hide();}}
if(ff){firstPageSelector.hide();firstPageSelector.next('.points').hide();}else{firstPageSelector.show();if(firstPageSelector.first().find('.page-nb').text()!=+firstPageSelector.first().nextAll('.page-number.page-show').first().text()-1){firstPageSelector.next('.points').show();}else{firstPageSelector.next('.points').hide();}}}
window.sidebarIconsLiveTime=0;setInterval(function(){window.sidebarIconsLiveTime++;},1000);function initializeTooltip(selector,additionalClass,options){var defaults={close:resetTooltip,track:false,tooltipClass:additionalClass,hide:false,position:{my:"center bottom-10",at:"center top",using:function(position,feedback){$(this).css(position);var $arrow=$('.tooltip-arrow');$arrow.removeClass('top').removeClass('bottom').addClass('left').addClass(feedback.vertical).addClass(feedback.horizontal);}},content:function(){var $el=$(this),symbolLimitAttr=$el.attr('tooltip-symbol-limit'),tooltipSymbolLimit=symbolLimitAttr?parseInt(symbolLimitAttr):500,elTitleText=$el.attr('title'),tooltipContent;if(!elTitleText){return false}
if($(this).attr('type')=='application/x-shockwave-flash'){return false;}
tooltipContent=elTitleText.length>tooltipSymbolLimit?elTitleText.substring(0,tooltipSymbolLimit)+'...':elTitleText;tooltipContent=tooltipContent.replace(/\\*'/g,"'");return tooltipContent+"<div class='tooltip-arrow'></div>";},open:showTooltipData}
function showTooltipData(event,ui){if(getBrowserWidth()<maxTabletSize&&$(event.toElement).closest('.user').length){$(ui.tooltip).addClass('to-hide');}
if($(event.toElement).closest('#editor-form').length&&!$(event.toElement).hasClass('color-select-icon')&&!$(event.toElement).parent().hasClass('color-select-icon')){$(ui.tooltip).addClass('to-hide');}
var $tooltip=$(ui.tooltip),$timer=$tooltip.find('.timer');var layout='',flag=false;if($timer.attr('data-layout')!==undefined){layout=$timer.attr('data-layout');flag=true;}else{layout='{d<}{dnn} days, {d>}{h<}{hnn} hours, {h>}{m<}{mnn} minutes and {m>}{snn} seconds';}
if($timer.length>0){console.log($timer.attr('data-time'));$timer.countdown({until:($timer.attr('data-time')-window.sidebarIconsLiveTime).toString(),layout:layout,padZeroes:true,format:flag?'HMS':undefined,});}}
function resetTooltip(){var tooltip=$(selector),timer=tooltip.find('.timer');try{timer.countdown('destroy');}catch(err){}
try{tooltip.tooltip("destroy");}catch(err){}
createTooltip();}
function createTooltip(){try{$(selector).tooltip(Object.assign({},defaults,options));}catch(err){}}
resetTooltip();}
function initializeStatBarTooltip(selector,additionalClass){function showTooltipData(event,ui){var $el=$(this).hasClass('energy-info')?$(this):$(this).closest('.energy-info'),$barStatus=$el.find('.bar-status'),$tooltip=ui.tooltip.find('.ui-tooltip-content'),result="",flag=false,msg={};if($barStatus.length){var barIncrement=parseInt($barStatus.attr('data-inc')),timestep=Math.abs(parseInt($barStatus.attr('data-timestep')));var template=Handlebars.templates['stat-bar-tooltip'];msg={name:$el.attr('id'),step:barIncrement,time:timestep/60};if($barStatus.hasClass('full')){msg.message=$el.attr('data-fullmsg');}else if($barStatus.hasClass('over')){msg.message=$el.attr('data-overmsg');}else{msg.timer=$barStatus.hasClass('countdown');}
result=template(msg);}else{result=$el.attr('data-title');ui.tooltip.addClass('m-top10');}
result+="<div class='tooltip-arrow'></div>";$tooltip.empty().append(result);var tooltipTime=$el.find('.countdown').attr('data-filltimeleft');$tooltip.find('.timer').attr('data-time',tooltipTime);var $timer=$tooltip.find('.timer');if($timer.length>0){if($timer.attr('data-layout')!==undefined){flag=true;}
$timer.countdown({until:$timer.attr('data-time'),layout:'{h<}{hnn}:{h>}{m<}{mnn}:{m>}{snn}',padZeroes:true,format:'HMS',});}}
function resetTooltip(){var tooltip=$(selector),timer=tooltip.find('.timer');try{timer.countdown('destroy');}catch(err){}
try{tooltip.tooltip("destroy");}catch(err){}
createTooltip();}
function createTooltip(){var $infoElement=$(selector),myVal="left center-10",atVal="right+15 center";if(getBrowserWidth()<minTabletSize){myVal="left top+7";atVal="left bottom";}
$(selector).tooltip({close:resetTooltip,tooltipClass:additionalClass,hide:false,position:{my:myVal,at:atVal},open:showTooltipData});}
resetTooltip();}
function checkTopPageLinksState(selector){if(selector.hasClass('desktop')||(selector.hasClass('tablet')&&getBrowserWidth()<=maxTabletSize)||(selector.hasClass('mobile')&&getBrowserWidth()<minTabletSize)){selector.addClass('activated').siblings('.tutorial-switcher').addClass('tpl-activated');}else{selector.removeClass('activated').siblings('.tutorial-switcher').removeClass('tpl-activated');}}
function checkTopPageContentTitleLinks(container,limit){if(!container){container=$('.content-wrapper')}
var contentTitle=container.find('.content-title');var topLinksListWrapper=contentTitle.find('.links-top-wrap');var topLinksList=topLinksListWrapper.find('.content-title-links>a');if(topLinksList.length>limit){checkTopPageLinksState(topLinksListWrapper);if(topLinksList.filter('.dd-important').length){var linksClone=topLinksListWrapper.clone().removeClass('activated').addClass('dd-important-wrapper');linksClone.find('.content-title-links a:not(.dd-important)').remove()
topLinksListWrapper.after(linksClone);topLinksListWrapper.addClass('dd-filter-important')}}}
function initializeTopPageLinks(){checkTopPageLinksState($('.content-title .links-top-wrap'));toggleTopPageLinks();}
function initializeAccordion(selector,options){var data=options||{};data.active=(data.active==undefined||data.active==-1)?true:data.active;selector.accordion({active:data.active,animated:false,collapsible:true,heightStyle:"content",beforeActivate:data.beforeActivate,activate:data.activate,header:data.header});}
function changeNumberWithComma(selector,parent,valueContainer,valueToAdd){var $val=selector.parents(parent).find(valueContainer);var value=$val.text().replace(/,/g,"");value=parseInt(value)+parseInt(valueToAdd);(value<0)?value=0:value;$val.text(value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}
function toNumberFormat(str){var value=str.toString().replace(/,/g,"");return value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");}
function toShortNumberFormat(str){var quadrillion=1000000000000000,trillion=1000000000000,billion=1000000000,million=1000000,thousand=1000,moneyPrefix="",value=str.toString().replace(/,/g,"");value=parseInt(value);if(value>=quadrillion){value=Math.round(value/quadrillion*10)/10;moneyPrefix='P';}else if(value>=trillion){value=Math.round(value/trillion*10)/10;moneyPrefix='T';}else if(value>=billion){value=Math.round(value/billion*10)/10;moneyPrefix='B';}else if(value>=million){value=Math.round(value/million*10)/10;moneyPrefix='M';}else if(value>=thousand){value=Math.round(value/thousand*10)/10;moneyPrefix='k';}
return value+moneyPrefix;}
function iconSwitcher(parent,iconType,postMethod){$.get('/images/v2/svg_icons/top_page_links/'+iconType+'.svg',function(payload){function svgIconParser(node){if(typeof(XMLSerializer)!=='undefined'){var serializer=new XMLSerializer();return serializer.serializeToString(node);}else if(node.xml){return node.xml;}
return '';};parent.children('svg').remove();parent.append(svgIconParser(payload));});var tutorialID=parent&&parent.parent()&&parent.parent().attr('id')||0
$.post("updateTutorials.php",{tutorialID:tutorialID,status:postMethod},function(){if(postMethod==='off'){parent.removeClass('tutorial-icon-hide').addClass('tutorial-icon-show');}else if(postMethod==='on'){parent.removeClass('tutorial-icon-show').addClass('tutorial-icon-hide');}});}
function tutorialSwitcher(){if(!tutorialSwitchInited){tutorialSwitchInited=true;$('body').on('click','.tutorial-switcher',function(){if($(this).attr('data-href')!=undefined){window.location=$(this).attr('data-href');}else{$('.tutorial-cont').toggle();var $el=$('.tutorial-icon-svg');var $tutorialSwitcher=$el.closest('.tutorial-switcher');if($el.hasClass('tutorial-icon-show')){iconSwitcher($el,'tutorial-hide','on');$tutorialSwitcher.attr('aria-label','Hide Tutorial');$('.tutorial-desc').focus();}else{iconSwitcher($el,'tutorial-icon','off');$tutorialSwitcher.attr('aria-label','Show Tutorial');}}});}}
function loadCheckBoxEvents(selectorWrapper){$(selectorWrapper+' div.prettycheckbox a,'
+selectorWrapper+' div.prettyradio a,'
+selectorWrapper+' div.prettycheckbox label,'
+selectorWrapper+' div.prettyradio label').on('touchstart click',function(e){e.preventDefault();var clickedParent=$(this).closest('.clearfix');var input=clickedParent.find('input');var fakeCheckable=clickedParent.find('a');if(input.attr('type')==='radio'){$('input[name='+input.attr('name')+']').each(function(index,el){$(el).removeAttr('checked').parent().find('a').removeClass('checked');});}
if(input.attr('checked')!==undefined){input.removeAttr('checked');}else{input.attr('checked','checked').change();}
fakeCheckable.toggleClass('checked');});$('div.prettycheckbox a, div.prettyradio a').on('keypress',function(e){$(this).click();e.preventDefault();});}
var $contentWrapper=null;$(function(){$contentWrapper=$('.content-wrapper');});function getRFC(){var rfc=$.cookie('rfc_v');if(!rfc){var cookies=document.cookie.split('; ');for(var i in cookies){var cookie=cookies[i].split('=');if(cookie[0]=='rfc_v'){return cookie[1];}}}
return rfc;}
function addRFC(url){var url=url||'';url+=((url.split('?').length>1)?'&':'?')+'rfcv='+getRFC();return url;}
function checkPageStatus(result){try{if(typeof result=='string'){var data=JSON.parse(result);}
else{var data=result;}
if(data.redirect!=undefined){if(data.redirect===true){location.href=location.protocol+'//'+location.hostname+'/'+data.url;}else if(data.redirect===false){$contentWrapper.html(data.content);}
return false;}else
return true;}catch(e){if(result=='Wrong RFC. '){$contentWrapper.html(result);return false;}
return true;}}
function onAjaxError(xhr,ajaxOptions,thrownError){if(xhr.status>0){var o=$('.content-title');if(o.length){o.nextAll().remove();}else{o=$contentWrapper.html('');}
if(o.length){informationMessageTemplate(o,false,false,'red common-action-error');o.nextAll('.common-action-error').find('.msg').html(xhr.status+' '+thrownError);}
setTimeout(function(){location.reload();},5000);}}
if($.cookie().uid=="1707527"){function ajaxAction(thisEl,parents,messageContainerClassName,onAjaxCompleteFunc){var aa=new AjaxHandler();aa.ajaxAction({selector:thisEl,parent:parents,msgContSelector:messageContainerClassName,complete:onAjaxCompleteFunc});aa.run();}
function getAction(obj){var ga=new AjaxHandler();ga.getAction(obj);ga.run();}
function ajaxWrapper(request_options,infobox_options){var aw=new AjaxHandler();aw.ajaxWrapper(request_options,infobox_options);aw.run();}}else{function ajaxAction(thisEl,parents,messageContainerClassName,onAjaxCompleteFunc){if(typeof onAjaxCompleteFunc==='undefined')
onAjaxCompleteFunc=function(){};var $el=$(thisEl);var $parent=$el.parents(parents);var selectorHref=window.location.protocol+'//'+window.location.hostname+'/'+$el.attr('href');var messagesContainer=$parent.find(messageContainerClassName);var $ajaxPlaceholder=$('.ajax-placeholder');messagesContainer.append('<img class="ajax-placeholder" src="/images/v2/main/ajax-loader.gif" />');$parent.find('.ajax-action').remove();$.ajax({url:addRFC(selectorHref),dataType:"text",success:function(data){if(!checkPageStatus(data))
return;try{var data=JSON.parse(data),html='<div class="ajax-action">'+data.msg+'</div>';messagesContainer.html("");messagesContainer.append(html);messagesContainer.parents('.info-msg-cont').removeClass("green red blue").addClass(data.color);messagesContainer.parents('.info-msg-cont').attr('tabindex',0);}catch(e){data='<div class="ajax-action">'+data+'</div>';messagesContainer.html("");messagesContainer.append(data);}},error:onAjaxError,complete:function(data){onAjaxCompleteFunc(data);$('.ajax-placeholder').hide();}});}
function getAction(obj){obj.success=obj.success||function(){};obj.error=obj.error||onAjaxError;obj.before=obj.before||function(){};obj.complete=obj.complete||function(){};var url=obj.action||(window.location.protocol+'//'+window.location.hostname+location.pathname);var options={url:addRFC(url),type:obj.type||"get",data:obj.data||{},async:typeof obj.async!=='undefined'?obj.async:true,beforeSend:function(xhr){obj.before(xhr);},success:function(msg){if(!checkPageStatus(msg))
return;obj.success(msg);},error:function(xhr,ajaxOptions,thrownError){if(typeof(xhr.error)==="function"){obj.error(xhr,ajaxOptions,thrownError);}else{informationMessageTemplateIn(xhr.error,true,false,"red");$(".info-msg .msg").text("Request error. Please try again.");}},complete:function(data){obj.complete(data);}};if(options.data.step!=undefined){}
if(obj.file){options.cache=false;options.contentType=false;options.processData=false;}
return $.ajax(options);}
function ajaxWrapper(request_options,infobox_options){if(infobox_options){var io=infobox_options;io.isTopDelimiterRequired=(typeof io.isTopDelimiterRequired==='undefined'?true:io.isTopDelimiterRequired);io.isBottomDelimiterRequired=(typeof io.isBottomDelimiterRequired==='undefined'?false:io.isBottomDelimiterRequired);informationMessageTemplateIn(io.elementIn,io.isTopDelimiterRequired,io.isBottomDelimiterRequired,io.color?io.color:"");io.elementIn.find('.info-msg-cont .msg').html('<img class="ajax-placeholder" src="/images/v2/main/ajax-loader.gif" />');}
var r=$.ajax({url:addRFC(request_options.url),dataType:request_options.dataType?request_options.dataType:"text",type:request_options.type,timeout:request_options.timeout,processData:request_options.processData!=undefined?request_options.processData:undefined,contentType:request_options.contentType!=undefined?request_options.contentType:undefined,cache:request_options.cache!=undefined?request_options.cache:undefined,headers:request_options.headers!=undefined?request_options.headers:undefined,data:request_options.data,async:request_options.async!=undefined?request_options.async:true,success:function(resp){if(!checkPageStatus(resp))
return;if(request_options.oncomplete)
request_options.oncomplete({responseText:resp});if(infobox_options){var io=infobox_options,text="";try{var responseData=JSON.parse(resp);io.color=responseData.color||"";text=responseData.msg;}catch(e){text=resp;}
informationMessageTemplateIn(io.elementIn,false,false,io.color?io.color:"");var data='<div class="ajax-action">'+text+'</div>';io.elementIn.find('.info-msg-cont .msg').html(data);}
if(request_options.onsuccess)
request_options.onsuccess(resp);},error:function(resp){if(typeof request_options.onerror==='function'){request_options.onerror.call(this,resp);}
if(infobox_options){var data='<div class="ajax-action">Request error. Please try again.</div>',$msg=io.elementIn.find('.info-msg-cont .msg');$msg.html(data);$msg.parents(".info-msg-cont").removeClass("green blue").addClass("red");}
onAjaxError.apply(this,arguments);}});return r;}}
function getClassSelector(_class){return "."+_class.trim().split(" ").join('.');}
function informationMessageTemplate(elementAfter,isTopDelimiterRequired,isBottomDelimiterRequired,color){var infoMsg=$('.info-msg-cont');var exceptionsInfoMsg=$('.travel-home-content .info-msg-cont');var infoMsgCount=(infoMsg)?infoMsg.length:0;var exceptionsInfoMsgCount=(exceptionsInfoMsg)?exceptionsInfoMsg.length:0;if(infoMsgCount===0||((infoMsgCount-exceptionsInfoMsgCount)==0)){if(color===undefined){color="";}
var delimiter='<hr class="delimiter-999 m-top10 m-bottom10">';var htmlTemplate='<div class="info-msg-cont '+color+' border-round">'+
'<div class="info-msg border-round">'+
'<i class="info-icon"></i>'+
'<div class="delimiter">'+
'<div class="msg right-round">'+
'<img class="ajax-placeholder" src="/images/v2/main/ajax-loader.gif" />'+
'</div>'+
'</div>'+
'</div>'+
'</div>';if(isTopDelimiterRequired){htmlTemplate=delimiter+htmlTemplate;}
if(isBottomDelimiterRequired){htmlTemplate+=delimiter;}
elementAfter.after(htmlTemplate);}}
function informationMessageTemplateIn(elementIn,isTopDelimiterRequired,isBottomDelimiterRequired,color){var info_msg=elementIn.find('.info-msg-cont');if(info_msg.length===0){if(color===undefined){color="";}
var delimiter='<hr class="delimiter-999 m-top10 m-bottom10">';var htmlTemplate='<div class="info-msg-cont '+color+' border-round">'+
'<div class="info-msg border-round">'+
'<i class="info-icon"></i>'+
'<div class="delimiter">'+
'<div class="msg right-round">'+
'<img class="ajax-placeholder" src="/images/v2/main/ajax-loader.gif" />'+
'</div>'+
'</div>'+
'</div>'+
'</div>';if(isTopDelimiterRequired){htmlTemplate=delimiter+htmlTemplate;}
if(isBottomDelimiterRequired){htmlTemplate+=delimiter;}
elementIn.append(htmlTemplate);}else{if(color)
info_msg.removeClass("green red blue").addClass(color);}}
function formAjaxAction($form,containerAppendAfter,isTopDelimiterRequired,isBottomDelimiterRequired,color){var $formActionLink=window.location.protocol+'//'+window.location.hostname+'/'+$form.attr('action');$.ajax({type:"POST",url:addRFC($formActionLink),data:$form.serialize(),success:function(data){if(!checkPageStatus(data))
return;$('.ajax-action').remove();informationMessageTemplate(containerAppendAfter,isTopDelimiterRequired,isBottomDelimiterRequired,color);data='<div class="ajax-action">'+data+'</div>';$('.info-msg-cont .msg').append(data);},error:onAjaxError});}
var animateProgressOverfullTotal=3;function animateProgressOverfull(el){var $el=$(el),animCount=parseInt($el.attr('animCount')||0);$el.css('opacity',0.2);$el.animate({opacity:1},{duration:500,complete:function(){$(this).animate({opacity:0.2},{duration:500,complete:function(){if(animateProgressOverfullTotal>animCount){$el.attr('animCount',animCount+1);animateProgressOverfull(el);}else{$el.closest('.overfull').removeClass('overfull');$el.css('opacity',1);$el.removeAttr('animCount');}}});}});}
var animateProgressTickEndTotal=10;function animateProgress(el){$(el).animate({opacity:1},{duration:500,complete:function(){$(this).animate({opacity:0},{duration:500,complete:function(){var $barStatus=$(this).closest('.energy-info').find('.bar-status');if(parseInt($barStatus.attr('data-tick'))<parseInt($barStatus.attr('data-until'))+animateProgressTickEndTotal){animateProgress(el);}}});}});}
function checkProgressOverfull(isRefresh){var $energyInfo=$('.menu-info .energy-info'),isStatRefreshed=isRefresh||false,statBars=getStatBarsCookie();$energyInfo.each(function(){var $el=$(this),$count=$el.find('.count'),countOld=parseInt(statBars[$el.attr('id')]),countCurrent=parseInt($count.attr('data-current')),countTotal=parseInt($count.attr('data-total')),$barStatus=$el.find('.bar-status');if(countOld>0&&((!isStatRefreshed&&countTotal==countCurrent&&countTotal>countOld)||(isStatRefreshed&&countOld<countCurrent&&countTotal<countCurrent))){$el.find('.line').addClass('overfull');statBars[$el.attr('id')]=0;}
if(countOld>0&&(countTotal>countCurrent&&countCurrent>countOld)){$barStatus.attr('data-tick',parseInt($barStatus.attr('data-until')));var $tickEnd=$el.find('.tick-end');$tickEnd.show();animateProgress($tickEnd);}
animateProgressOverfull($el.find('.overfull .progress-line-timer'));});setStatBarsCookie(statBars);}
function setStatBarsCookie(data){var statBars=data||{energy:0,nerve:0,happy:0,life:0,chain:0};if(!$.cookie('statBars')){$.cookie('statBars',JSON.stringify(statBars),{expires:30});}else{$.cookie('statBars',JSON.stringify(statBars));}}
function getStatBarsCookie(){var statBars=$.parseJSON($.cookie().statBars);if(statBars){return statBars;}else{return false;}}
function refreshTopOfSidebar(){}
function ajax_data_loader(page,start,limit,order,orderByName,handlebars_tpl,handlebars_wrap){var $handlebars_wrap=$('#'+handlebars_wrap);var loader=$('<img class="ajax-loader">');loader.attr({src:'/images/v2/main/ajax_loader_tpl.gif'});loader.css({position:'absolute'});var loaderHalfHeight=16;var loaderHalfWidth=16;function handlebarsInit(data){var template=Handlebars.templates[handlebars_tpl];$handlebars_wrap.html(template(data));$handlebars_wrap.animate({height:$handlebars_wrap.children(':first').height()});var $paginaton=$('.pagination');$paginaton.find('a').click(function(event){event.preventDefault();var href=$(this).attr('href');var re=new RegExp("start=(\\d+)","g");var startHref=re.exec(href);if(typeof startHref[1]!=="undefined"&&startHref!==null){start=startHref[1];ajax_data_loader(page,start,limit,order,orderByName,handlebars_tpl,handlebars_wrap);}});loader.remove();}
$.ajax({url:"/"+page+'.php',data:{start:start,limit:limit,order:order,orderByName:orderByName},dataType:"json",type:"GET",beforeSend:function(){if($handlebars_wrap.height()!==0){$handlebars_wrap.css({height:$handlebars_wrap.height()});}
var loaderPositionTop=($handlebars_wrap.height()/2-loaderHalfHeight)+'px';var loaderPositionLeft=($handlebars_wrap.width()/2-loaderHalfWidth)+'px';loader.css({top:loaderPositionTop,left:loaderPositionLeft});$handlebars_wrap.append(loader);},success:function(data){if(!checkPageStatus(data))
return;handlebarsInit(data);},error:function(data){data.message='Request error. Please try again.';handlebarsInit(data);}});return false;}
function hideScrollbar(containerClass){$('.'+containerClass+' .l').hide();$('.'+containerClass+' .r').hide();$('.'+containerClass+' .viewport').hide();$('.'+containerClass+' .scrollbar').hide();}
function initiateNativeMobileDropList(selector,parent){var selectorParent=parent||'.select-wrap';var iOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);if(isTouchDevice()&&!iOS||isOperaMini()){var classes=isOperaMini()?'touched om':'touched';selector.closest(selectorParent).addClass(classes);selector.each(function(){$(this).selectmenu();});}}
function initializeDropdown(selectOption,containerClass,width,scrollHeight,sizethumb,changeHandler,allowMobileDropdown){if(!isTouchDevice()||allowMobileDropdown){if(scrollHeight===undefined||scrollHeight===null){scrollHeight="170";}
if(sizethumb===undefined||sizethumb===null){sizethumb="auto";}
var $selectWrap=selectOption.closest('.select-wrap');var $list=$selectWrap.find('.list');console.log('selectOption',selectOption);selectOption.selectmenu({appendTo:'.'+containerClass+' .viewport .overview',width:width,maxHeight:"auto",create:function(event,ui){$('.select-wrap .ui-selectmenu').attr('aria-live','polite');},open:function(){if($(this).closest('.select-wrap').length&&$(this).closest('.select-wrap').hasClass('disable')){return;}
$('.'+containerClass+' .l').show();$('.'+containerClass+' .r').show();$('.'+containerClass+' .viewport').show();$('.'+containerClass+' .scrollbar').show();$('.'+containerClass).tinyscrollbar({scroll:true,size:scrollHeight,sizethumb:sizethumb});$('.'+containerClass+' .scrollbar.disable').hide();selectOption.closest('.select-wrap').addClass('s-open');if(isOperaMini()){var heightOfOneEelemet=34;var totalListHeight=($selectWrap.find('.ui-selectmenu-menu ul li').index()+1)*heightOfOneEelemet;$list.find('.list-bottom').remove();if(!$list.find('.list-bottom').length){$list.append("<div class='list-bottom' ><div class='l'></div><div class='r'></div><div class='clear'></div></div>");}
$list.height(totalListHeight);$selectWrap.find('.viewport').height(totalListHeight);}},change:function(event,ui){if(typeof changeHandler=="function")
changeHandler(ui);},close:function(){$('.'+containerClass).tinyscrollbar({scroll:false,size:scrollHeight,sizethumb:sizethumb});hideScrollbar(containerClass);selectOption.closest('.select-wrap').removeClass('s-open');if(isOperaMini()){selectOption.closest('.select-wrap').find('.list').height(0);$selectWrap.find('.list .list-bottom').remove();}}});}else{$('.select-type-l, .select-type-r').hide();}}
function initDropdown(selectOption,containerClass,customOptions){if(!selectOption||!containerClass){console.error('Some of the required params weren\'t provided');return;}
var defaults={scrollHeight:'170',width:'100',scrollbarClass:'scrollbar-bright',allowMobileDropdown:false,isDefault:true}
var options=$.extend(defaults,customOptions);var keysTriggerOpen=[$.ui.keyCode.ENTER,$.ui.keyCode.UP,$.ui.keyCode.DOWN,$.ui.keyCode.LEFT,$.ui.keyCode.RIGHT];var $selectWrap=selectOption.closest('.select-wrap');$selectWrap.addClass('dropdown-new');$selectWrap.css('width',options.width);if(options.isDefault){$selectWrap.addClass('dropdown-default');}
if(!isTouchDevice()||options.allowMobileDropdown){selectOption.selectmenu({appendTo:'.'+containerClass,create:function(event,ui){$selectWrap.find('.ui-selectmenu').attr('aria-live','polite');$('.'+containerClass).addClass('dropdown-content');$selectWrap.find('.ui-selectmenu').on('keydown',function(e){if(keysTriggerOpen.includes(e.which)){selectOption.selectmenu('open');}})},open:function(){if($(this).closest('.select-wrap').length&&$(this).closest('.select-wrap').hasClass('disable')){return;}
var $dropdownContent=$('.'+containerClass+' .ui-selectmenu-menu-dropdown');$dropdownContent.addClass(options.scrollbarClass);$dropdownContent.css('max-height',+options.scrollHeight);selectOption.closest('.select-wrap').addClass('s-open');$selectWrap.find('.ui-selectmenu-item-selected a').focus();},change:function(event,ui){if(typeof options.changeHandler=="function")
options.changeHandler(ui);},close:function(){$selectWrap.removeClass('s-open');}});}else{selectOption.show();}}
function initializeTabsDropDown(tabSelector,dropDownSelector,dropDownListSelector,dropDownWidth,activeTab){var $controlTabs=$(tabSelector);var actTab=activeTab||0;$controlTabs.tabs({active:activeTab});var tabControlDisabledIndexes=[];$controlTabs.find('.control-tabs > li').each(function(index){if($(this).hasClass('ui-state-disabled')){tabControlDisabledIndexes.push(index-1);}});var $controlNavList=$(dropDownSelector);initDropdown($controlNavList,dropDownListSelector,{width:dropDownWidth});function updateDropdownState(element){var optionIndex=isTouchDevice()?element.find(':selected').index():element.parent('.select-wrap').find('.ui-selectmenu-item-selected').index();$controlTabs.find('a').eq(optionIndex).trigger('click');}
$controlNavList.change(function(){updateDropdownState($(this));});var isInitForTouch=false;$(window).resize(function(){if(getBrowserWidth()<=maxTabletSize&&!isInitForTouch){isInitForTouch=true;var activeTabIndex=$controlTabs.tabs("option","active");$controlNavList.find('option').each(function(){if($.inArray($(this).index(),tabControlDisabledIndexes)!=-1){$(this).attr('disabled','disabled');}});$controlNavList.find('option').eq(activeTabIndex).attr('selected','selected');if(!isTouchDevice()){$controlNavList.selectmenu();}}
if(getBrowserWidth()>maxTabletSize&&isInitForTouch){isInitForTouch=false;}});}
function toggleOptionsForTinyMCE(){$('.mce-tinymce .mce-container-body > .mce-menubar, .mce-tinymce .mce-container-body > .mce-panel').not('.mce-edit-area').slideToggle();$('.mce-tinymce .mce-container-body > .mce-edit-area.mce-panel iframe').toggleClass('mce-minimized',500,function(){bodyTinymceAutoHeight();});}
function isLocalStorageAvailable(){try{return 'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}}
function cleanLocalAreaContent(name){var key=EDITOR_CONTENT_PREFIX+name;if(isLocalStorageAvailable()){localStorage.removeItem(key);console.log(key+' remove options')
localStorage.removeItem(key+'options');}}
function bodyTinymceScrollDown(){var frameWrapper=$('.computer-frame-wrap');if(tinymce.activeEditor){if(!frameWrapper.length){var $bodyTinymce=$(tinymce.activeEditor.getBody());$bodyTinymce.animate({scrollTop:$bodyTinymce.height()},{duration:'medium',easing:'swing'});}
tinyMCE.activeEditor.focus();}}
function bodyTinymceAutoHeight(){if(tinymce.activeEditor){var $bodyTinymce=$(tinymce.activeEditor.getBody());var marginBody=$bodyTinymce.outerHeight(true)-$bodyTinymce.outerHeight();$bodyTinymce.css('min-height',$('.mce-tinymce .mce-container-body > .mce-edit-area.mce-panel iframe').height()-marginBody+'px');}}
var isTinyMCEFocusHotKeyBinded=false;function tinyMCEFocusHotKeyBind(){var alt=18;var insert=45;var isAlt=false;$(document).keyup(function(e){if(e.which==alt)isAlt=false;}).keydown(function(e){if(e.which==alt)isAlt=true;if(e.which==insert&&isAlt==true){tinyMCE.activeEditor.focus();}});}
function initializeTinyMCE(onAnimateComplete,options){if(isOperaMini()){return;}
var animateComplete=function(){console.log('animateComplete');onAnimateComplete&&onAnimateComplete()};if(tinymce){tinymce.baseURL='/js/script/lib/tinymce';}
tinymce.init({max_chars:10,convert_urls:false,force_br_newlines:true,force_p_newlines:false,browser_spellcheck:true,resize:false,style_formats_merge:true,style_formats:[{title:'Comment HTML',icon:"code",inline:'span',classes:'tinymce-comment'}],invalid_elements:"pre",default_link_target:"_blank",paste_preprocess:function(plugin,args){console.log(args.content);},content_css:"/css/style/tinycustom.css",selector:'textarea.mail-text-area, textarea.tiny-area',theme:"modern",plugins:["advlist autolink link image lists customcharmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table directionality customemoticons template paste textcolor"],toolbar:"insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | fullscreen | link image | "+
"bullist numlist outdent indent | customemoticons | forecolor backcolor ",setup:function(editor){console.log('editor-id',editor.id)
editor.on('init',function(e){if(isLocalStorageAvailable()){var content=localStorage.getItem(EDITOR_CONTENT_PREFIX+editor.id);var ct='';if(content){ct+=content.replace(ct,"");console.log(tinymce.activeEditor.getContent());if(tinymce.activeEditor.getContent().length==0||tinymce.activeEditor.getContent()=='<p>&amp;nbsp;</p>'){tinymce.activeEditor.setContent(ct);}
bodyTinymceScrollDown();}
if(options&&options.afterInit)
options.afterInit(editor);}
$('.mce-tinymce .mce-container-body > .mce-menubar, .mce-tinymce .mce-container-body > .mce-panel').not('.mce-edit-area').hide();$('.mce-tinymce .mce-container-body > .mce-edit-area.mce-panel iframe').addClass('mce-minimized');$('.mce-tinymce.mce-container.mce-panel .mce-container-body > .mce-edit-area.mce-panel').find('iframe').removeAttr('title').attr('aria-label','Rich Text Area. Press ALT-INSERT to start writing').end().animate({height:"show",opacity:"show"},"fast",function(){animateComplete();});bodyTinymceAutoHeight();if(!isTinyMCEFocusHotKeyBinded)tinyMCEFocusHotKeyBind();});if(options&&options.afterSetup)
options.afterSetup(editor);editor.on('paste',function(e){});editor.on('keyup',function(e){if(isLocalStorageAvailable()){localStorage.setItem(EDITOR_CONTENT_PREFIX+editor.id,editor.getContent());}});editor.on('change',function(e){console.log('on global editor change');if(isLocalStorageAvailable()){localStorage.setItem(EDITOR_CONTENT_PREFIX+editor.id,e.level.content);}});editor.on('click',function(event){console.log('on global event click');if($('.ac-search.ui-autocomplete-input').length&&$('.ac-search.ui-autocomplete-input').hasClass('ui-autocomplete-input')){var acSearch=$('.content-wrapper .ac-search');acSearch.removeClass('ac-focus').nextAll('.ac-focus-input').removeClass('ac-focus-input');acSearch.addClass('click-on-editor');acSearch.autocomplete('close');}});}});function setPlainText(e){console.log(e);var ed=tinyMCE.get('elm1');ed.pasteAsPlainText=true;if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){ed.onKeyDown.add(function(ed,e){if(((tinymce.isMac?e.metaKey:e.ctrlKey)&&e.keyCode==86)||(e.shiftKey&&e.keyCode==45))
ed.pasteAsPlainText=true;});}else{ed.onPaste.addToTop(function(ed,e){ed.pasteAsPlainText=true;});}}}
function userSearchTypeObj(instance){var isHeaderAcSearch=instance.closest('.header').length||instance.closest('.isAcSearch').length||instance.attr('data-actype');var indexUserSearchType=($.cookie('userSearchType'))?$.cookie('userSearchType'):0;var $currentUserSearchType=instance.closest('form').find('.search-type').find('option').eq(indexUserSearchType);if(!$currentUserSearchType.length){$currentUserSearchType=instance.closest('form').find('.search-type').find('option[selected]')}
var dataAcType=instance.attr('data-actype');if(dataAcType){$currentUserSearchType=$('<option>').val(dataAcType).attr('data-'+dataAcType,1).attr('data-actype',true);}
return{isHeaderAcSearch:isHeaderAcSearch,currentUserSearchType:$currentUserSearchType};}
var iMarketSearchCache=(function(storage,limit){var STORAGE_KEY_NAME='iMarketSearchCache';return{get:function(){var cache=JSON.parse(storage.getItem(STORAGE_KEY_NAME)||'[]');return cache.slice(0,limit);},set:function(item){var list=this.get();list=[item].concat(list.filter(function(_){return(_.value!==item.value||_.value.indexOf(item.value)===-1);}));storage.setItem(STORAGE_KEY_NAME,JSON.stringify(list.slice(0,limit)));return list}}})(localStorage,5);function initializeAutocompleteSearch(options){var defOptions={type:'all',isNotLink:false};var opt=typeof(options)==="object"?$.extend(defOptions,options):defOptions;$('.ac-search').each(function(index){var instance=$(this).attr('id')||$(this).attr('id',"ac-search-"+index).attr('id');var $instance=$("#"+instance);var userSearchType=userSearchTypeObj($instance);var acOptionOrder='';switch(opt.type){case 'friends':acOptionOrder='<li id="ac-friends" class="active" data-minlength="0"><a href="#">Friends</a></li>'+
'<li id="ac-factions" class="" data-minlength="0"><a href="#">Faction</a></li>'+
'<li id="ac-company" class="" data-minlength="0"><a href="#">Company</a></li>'+
'<li id="ac-all" class=""><a href="#">All</a></li>';break;case 'factions':acOptionOrder='<li id="ac-factions" class="active" data-minlength="0"><a href="#">Faction</a></li>'+
'<li id="ac-friends" class="" data-minlength="0"><a href="#">Friends</a></li>'+
'<li id="ac-company" class="" data-minlength="0"><a href="#">Company</a></li>'+
'<li id="ac-all" class=""><a href="#">All</a></li>';break;case 'company':acOptionOrder='<li id="ac-company" class="active" data-minlength="0"><a href="#">Company</a></li>'+
'<li id="ac-friends" class="" data-minlength="0"><a href="#">Friends</a></li>'+
'<li id="ac-factions" class="" data-minlength="0"><a href="#">Faction</a></li>'+
'<li id="ac-all" class=""><a href="#">All</a></li>';break;default:acOptionOrder='<li id="ac-friends" class="" data-minlength="0"><a href="#">Friends</a></li>'+
'<li id="ac-factions" class="" data-minlength="0"><a href="#">Faction</a></li>'+
'<li id="ac-company" class="" data-minlength="0"><a href="#">Company</a></li>'+
'<li id="ac-all" class="active"><a href="#">All</a></li>';break;}
var acFaction=(!userSearchType.isHeaderAcSearch)?'<ul class="ac-options">'+acOptionOrder+'</ul>':'';if(!$instance.parent().hasClass('ac-wrapper')){$instance.wrap('<div class="ac-wrapper"></div>');var inHeader=!!$instance.parents('#topHeader').length;var scrollbarDOM=inHeader?'<div class="viewport"></div>':'<div class="viewport scrollbar-bright"></div>';$instance.after('<div class="autocomplete-wrap" id="'+instance+'-cont">'+acFaction+scrollbarDOM);}else{return;}
var action=location.protocol+'//'+location.host+'/'+$instance.attr('data-action')+'.php';var userNotFoundMsg=(userSearchType.isHeaderAcSearch)?userSearchType.currentUserSearchType.val()+" cannot be found":"No person could be found";var enter=13;var acOption='ac-'+opt.type;var $containerId=$('#'+instance+'-cont');Object.size=function(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key))size++;}
return size;};$instance.autocomplete({appendTo:"#"+instance+"-cont .viewport",position:{of:null},create:function(event){var $el=$(this);var isDataAcType=userSearchType.currentUserSearchType.attr('data-actype');var $options=$('#'+instance+'-cont.autocomplete-wrap .ac-options > li');$('.search-text, select.search-type').blur(function(){$containerId.removeClass('ac-focus-input');$instance.removeClass('ac-focus');var inputData=$instance.val();if(inputData){if($instance.val().match(/(.*)\[(.*)\]/)){$instance.addClass('chosen');}else{$instance.removeClass('chosen');}}
if($instance.hasClass('ui-autocomplete-input')){$instance.autocomplete("close");}});$options.find('a').click(function(event){event.preventDefault();});$options.click(function(event){event.stopPropagation();var $el=$(this);$el.parents('.autocomplete-wrap').addClass('ac-focus-input');$el.siblings().removeClass('active').end().addClass('active');acOption=$el.attr('id');$instance.blur();if($instance.hasClass('ui-autocomplete-input')){$instance.autocomplete("close");}
if($options.siblings('.active').attr('data-minlength')){$instance.autocomplete("option","minLength",0);$instance.autocomplete("search",$instance.val());}else{$containerId.find('.ui-autocomplete').hide();$instance.removeClass('open');$containerId.removeClass('open');$instance.autocomplete("option","minLength",1);$instance.autocomplete("search",$instance.val());}});function updateContainerWidth(){var totalWidth=parseInt($instance.width())
+parseInt($instance.css('paddingLeft'))
+parseInt($instance.css('paddingRight'));$containerId.width(totalWidth);$containerId.find('.ui-autocomplete').width(totalWidth);}
$instance.focus(function(){var userSearchType=userSearchTypeObj($instance);if(userSearchType.isHeaderAcSearch==='imarket'){$instance.autocomplete("search","");}
if(userSearchType.isHeaderAcSearch){var dataMinLength=+!(userSearchType.currentUserSearchType.attr('data-minlength'));$instance.autocomplete("option","minLength",dataMinLength);$instance.autocomplete("search","");userSearchType.currentUserSearchType.attr('data-off')?$instance.autocomplete("disable"):$instance.autocomplete("enable");if(isDataAcType){updateContainerWidth();}}else{$instance.addClass('ac-focus');$containerId.css({left:$instance.css('margin-left')});updateContainerWidth();$containerId.addClass('ac-focus-input');}
$(window).resize()});$(window).resize(function(){updateContainerWidth();var userSearchType=userSearchTypeObj($instance);if(userSearchType.isHeaderAcSearch){var isMobileUserSearchType=false;if(getBrowserWidth()<=maxTabletSize&&!isMobileUserSearchType){isMobileUserSearchType=true;var indexUserSearchType=userSearchType.currentUserSearchType.index();var $searchTypeRadio=$('.search-type-radio .choice-container .radio-css');$searchTypeRadio.prop('checked',false);$searchTypeRadio.eq(indexUserSearchType).prop('checked',true);}
if(getBrowserWidth()>maxTabletSize&&isMobileUserSearchType){isMobileUserSearchType=false;}}});},select:function(event,ui){if(opt.isNotLink){event.preventDefault();}
var userSearchType=userSearchTypeObj($instance);var isDataAcType=userSearchType.currentUserSearchType.attr('data-actype');var isLocationDisabled=+userSearchType.currentUserSearchType.attr('data-nolocation');$containerId.removeClass('ac-focus-input');$instance.removeClass('ac-focus').blur();if(ui.item.value!=userNotFoundMsg){$instance.val(ui.item.value);$instance.addClass('chosen');$instance.trigger('chosen');if(typeof showNotification=='function'){showNotification(event);}}else{if(!$instance.val().match(/(.*)\[(.*)\]/)){$instance.removeClass('chosen');}
$instance.text('');}
if($instance.hasClass('ui-autocomplete-input')){$instance.autocomplete("close");}
if(userSearchType.currentUserSearchType.val()==='imarket'){iMarketSearchCache.set(ui.item);}
if(userSearchType.currentUserSearchType.val()==='places'){var action=window.location.protocol+'//'+window.location.hostname+'/'+'autocompleteHeaderAjaxAction.php';$.ajax({url:addRFC(action),dataType:"json",data:{places:ui.item.id,option:'popularity'},success:function(data){}});if(ui.item.value==="Points Market"){$('#ac-link-'+ui.item.id).attr('href',ui.item.url+'?refresh='+Math.floor(new Date().getTime()/1000));}}
if(userSearchType.isHeaderAcSearch){if(event.which==enter&&ui.item.url){window.location=ui.item.url;}
if(isLocationDisabled){$instance.closest('form').trigger('submit');return true;}
if(isDataAcType){$('input[name='+$instance.attr('data-actype')+'ID]').val(ui.item.id);}}
return false;},source:function(request,response){var userSearchType=userSearchTypeObj($instance);if(userSearchType.isHeaderAcSearch){acOption=userSearchType.currentUserSearchType.val();}
var isLocationDisabled=+userSearchType.currentUserSearchType.attr('data-nolocation');var isCacheAvailable=+userSearchType.currentUserSearchType.attr('data-cache');var searchCache=acOption==='imarket'?iMarketSearchCache.get():[];$.ajax({url:addRFC(action),dataType:"json",data:{q:request.term,option:acOption,caches:searchCache},success:function(data){if(data&&(Object.size(data)||data.list)){if(userSearchType.isHeaderAcSearch){var template=Handlebars.templates['search-header-template'];var itemId;var list;if(acOption==='imarket'&&request.term===''&&isCacheAvailable){list=searchCache;}else{list=$.map(data.list,function(item){itemId=userSearchType.currentUserSearchType.attr('data-user')?" ["+item.id+"]":'';var tpl=template({search:data.search,list:item});return{label:tpl,value:item.name+itemId,id:item.id,url:item.url};})}
response(list);}
else{response($.map(data,function(item){return{label:item,value:item.name+" ["+item.id+"]",url:item.url};}));}}else{response({value:userNotFoundMsg});}}});},open:function(){$instance.addClass('open');$containerId.addClass('open');$instance.closest('form').find('.search-type').selectmenu('close');},close:function(event){if(($('body').hasClass('noSelect')||$containerId.hasClass('ac-focus-input'))&&event.which!=enter){$containerId.find('.ui-autocomplete').show();}else{$instance.removeClass('open');$containerId.removeClass('open');}
if($instance.hasClass('click-on-editor')){if(typeof showNotification=='function'){showNotification(event);}
$instance.removeClass('click-on-editor');}}});$.ui.autocomplete.prototype._renderItem=function(ul,item){if(ul.closest('.header').length||ul.closest('.ac-wrapper').find('.ac-search').attr('data-actype')){return $(item.label).data("item.autocomplete",item).appendTo(ul);}
else{var onlineClass=(item.label==item.value)?'empty':(item.label.online=='online'?'online':(item.label.online=='offline'?'offline':(item.label.online=='idle'?'away':'')));return $("<li class='"+onlineClass+" ui-custom-item'></li>").data("item.autocomplete",item).append("<a>"+item.value+"</a>").appendTo(ul);}};});}
var animElement;function highlightElement(constPath){var pathname=constPath||$(location).attr('pathname');var params=$(location).attr('search');var currenturl=pathname+params;$.ajax({type:'GET',url:'/missionChecker.php',dataType:'json',data:{currenturl:currenturl},success:function(data1){if(!data1)return;stopAnimateElements();if(data1.elID){window.highlightElementResult=data1.elID.split('.').join('').split(',');}
$('[data-role="alert"]').removeAttr('role').removeAttr('data-role').removeAttr('aria-labelledby','wai-mission-desc');if(data1.task!=null){if(!isObject(data1.task)){var $mission=$("#currentMissionTask"),additionalMsg="";$mission.text(data1.task);setTimeout(function(){animateElement(data1.elID);},1000);var $elID=$(data1.elID);if(data1.elID&&$elID.hasClass('highlight-active')){var $el=$elID;if($el.length>1){$el=$($el.get().reverse());}
$mission=$el;additionalMsg="Click";}
$mission.attr('role','alert').attr('data-role','alert').attr('aria-labelledby','wai-mission-desc').before('<span id="wai-mission-desc" class="wai">'+
'Next step of mission is '+data1.task+'. '+additionalMsg+
'</span>');}
else{$("#currentMissionTask").text("Visit George");}}else{$("#currentMissionTask").text("Visit George");}}});}
function isObject(val){return(typeof val==='object');}
function animateElement(el){$(el).css({'-webkit-animation-iteration-count':'infinite','animation-iteration-count':'infinite'}).addClass('highlight-active');}
function animateElementJS(el){var $el=$(el);var opacity=$el.css('opacity')==1?0.3:1;$el.animate({opacity:opacity},500,'swing',function(){animateElementJS(el);});}
function animateElementCounter(el,count){var iterationCount=count?count.toString():'infinite';var $el=$(el);$el.css({'-webkit-animation-iteration-count':iterationCount,'animation-iteration-count':iterationCount}).addClass('highlight-active');$el.before($el.clone(true));$el.remove();}
function stopAnimateElements($container){var $wrapper=$container||$('body');var animatedElements=$wrapper.find('.highlight-active');animatedElements.removeClass('highlight-active');}
function animateAttentionElement($element,bg,delay){var delay=delay||3000;var $newStatement=$element;$newStatement.addClass(bg);animateElement($newStatement);setTimeout(function(){$newStatement.removeClass(bg);stopAnimateElements($('.content-wrapper'));},delay);}
function pulseElement(el){$(el).closest('a').effect("bounce","slow");}
function deleteCookie(name){document.cookie=name+"=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT";$.cookie(name,null,{domain:'.'+window.location.host});}
function deleteChatsCookie(){deleteCookie('secret');deleteCookie('chat_secret');}
function setSidebarStatesCookie(isReloadRequired){var $sidebar=$('.menu-list');var $body=$('body');var sidebarStates={isDesktopVersion:!$body.hasClass('r'),isQuickLinksExpanded:$sidebar.hasClass('expanded'),isTopBarsHidden:$sidebar.hasClass('hidden-tBars'),isBottomBarsHidden:$sidebar.hasClass('hidden-bBars'),isIconsHidden:$sidebar.hasClass('hidden-points'),isInfoHidden:$sidebar.hasClass('hidden-info'),isAdditionalInfoHidden:$sidebar.hasClass('hidden-add')};var sidebarStatesCookieName='sidebarStates';$.cookie(sidebarStatesCookieName,null);$.cookie(sidebarStatesCookieName,JSON.stringify(sidebarStates),{expires:18262});var sidebarMobileStates={isDesktopVersion:$body.hasClass('r')?'r':'',isQuickLinksExpanded:$sidebar.hasClass('expanded')?'expanded':'',isTopBarsHidden:$sidebar.hasClass('hidden-tBars')?'hidden-tBars':'',isBottomBarsHidden:$sidebar.hasClass('hidden-bBars')?'hidden-bBars':'',isIconsHidden:$sidebar.hasClass('hidden-points')?'hidden-points':'',isInfoHidden:$sidebar.hasClass('hidden-info')?'hidden-info':'',isAdditionalInfoHidden:$sidebar.hasClass('hidden-add')?'hidden-add':''};var action=window.location.protocol+'//'+window.location.hostname+(window.location.port?':'+window.location.port:'')+'/'+'sidebarAjaxAction.php';$.ajax({type:"POST",url:action,data:{sidebarMobileStates:sidebarMobileStates},success:function(data){console.log(window.location.href);if(isReloadRequired){location.reload();}}});}
function getRand(max){var mirror=0;return Math.random()*max+mirror;}
function saveInitRotation(selector,x,y){if(!selector.attr('data-rotateX')||!selector.attr('data-rotateY')){selector.attr('data-rotateX',x).attr('data-rotateY',y);}}
function changeRotation(selectors,x,y){selectors.each(function(){var $el=$(this);$el.css('transform','perspective(1000px) rotateY('+y+'deg) rotateX('+x+'deg)');saveInitRotation($el,x,y);});}
function setRandomRotation(selectors){var max=90,maxHalf=max/2;selectors.each(function(){var $el=$(this);var decreasingValue=500;if($el.height()>decreasingValue){max=max*decreasingValue/$el.height();maxHalf=max/2;}
var x=getRand(max)-maxHalf,y=getRand(max)-maxHalf;changeRotation($el,x,y);});}
function updateRotation(selectors,shiftX,shiftY){selectors.each(function(){var $el=$(this);changeRotation($el,parseFloat($el.attr('data-rotateX'))+shiftX,parseFloat($el.attr('data-rotateY'))+shiftY);});}
function getBoxesWithTitles(){return $('.title-black, .title-red, .title-gray, .title-brown, .title-green').parent();}
function getTorn3DSelector(){return $('#menu-list-accordion > li, '+
'.city-banner, .info-msg-cont, '+
'.header, .content-title, '+
'.content-wrapper > [class*="-wrap"]').not('[class*="cont-"], [class*="title-"]');}
function initTorn3D(){setRandomRotation(getBoxesWithTitles());setRandomRotation(getTorn3DSelector());setRandomRotation($('.tabs, .tab-menu-cont'));}
function updateTorn3D(event){var shift=10,shiftX=event.clientX/$(this).height()*shift,shiftY=event.clientY/$(this).width()*shift;updateRotation($('[data-rotateX][data-rotateY]'),shiftX,shiftY);}
function initTorn3DOnAJAXComplete(){var $contentWrapper=$('.content-wrapper');if($('body').hasClass('three-dimensional')&&!($contentWrapper.find('[data-rotateX][data-rotateY]').length||$contentWrapper.attr('data-rotateX'))){setRandomRotation($contentWrapper);}}
function checkHonorName(){if(/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())){$('.user.name img').each(function(){var $el=$(this);if($el.width()==0){$el.closest('.user.name').addClass('alt');}}).load(function(){$(this).closest('.user.name').removeClass('alt');});}}
function checkIsBrowserZoomed(){var zoom=detectZoom.zoom();var device=detectZoom.device();return zoom!==device;}
function bindZoomButtonEvents(){$('body').on('click','.zoom-tooltip .button',function(event){event.preventDefault();var threeDays=259200000,fiftyYears=1577923200000,$el=$(this);if($el.hasClass('turn-off')){setCookie('zoomNotification',$.now()+fiftyYears,18262);hideZoomNotification();}else if($el.hasClass('cancel')){setCookie('zoomNotification',$.now()+threeDays,18262);hideZoomNotification();}})}
function hideZoomNotification(){$('.zoom-tooltip').hide();}
function showZoomNotification(){var $template=$('.zoom-tooltip');if($template.length){$template.show();bindZoomButtonEvents();}}
function setCookie(name,value,expires){if(!$.cookie(name)){$.cookie(name,value,{expires:expires});}else{$.cookie(name,value);}}
function checkZoomCookie(){if((!$.cookie('zoomNotification')||$.cookie('zoomNotification')<$.now())&&!isTouchDevice()&&navigator.userAgent.indexOf('Mac OS X')===-1&&checkIsBrowserZoomed()){showZoomNotification();}}
$(function(){highlightElement();initializeAutocompleteSearch();initializeTopPageLinks();initializeTooltip('.header, .menu-sections, .menu-list .icons, .menu-list .menu-info-mobile-wrapper,'+
'.menu-list .m-account, .menu-list .m-areas, .menu-list .m-lists, .menu-list .m-specials,'+
'.content-wrapper','white-tooltip');initializeStatBarTooltip('.menu-list .energy-info-cont .energy-info','white-tooltip stat-bar-tooltip');$('.ellipsis').ellipsis({row:1,responsive:true});if($('#frmLogin').is(":visible")){deleteChatsCookie();if($.cookie('three_dimensional')){$.cookie('three_dimensional',false);}}
$(window).focus(function(){$('.ui-tabs-active a').blur();});var $body=$('body');$('.three-dimensional-switcher').click(function(event){event.preventDefault();var threeDimensionalFlag=!$body.hasClass('three-dimensional');if(!$.cookie('three_dimensional')){$.cookie('three_dimensional',threeDimensionalFlag,{expires:24});}else{$.cookie('three_dimensional',threeDimensionalFlag);}
location.reload();});checkHonorName();checkZoomCookie();$('#menu-list-accordion').on('click','.refillClick',function(e){var txt=$(this).attr('data-act');$.get('/refill.php',{refiltype:txt},function(data){refreshTopOfSidebar();$.cookie('refill',JSON.stringify({energy:txt=='e',nerve:txt=='n'}),{expires:18262});if($(this).hasClass('energy')){$('.refills-link.energy').addClass('refill-hide');}
if($(this).hasClass('nerve')){$('.refills-link.nerve').addClass('refill-hide');}});});});function updateCollection(collection){var coll=collection;var itemPosition=Math.floor(Math.random()*coll.length);var item=coll[itemPosition];item.animate({opacity:0},100,function(){coll.splice(itemPosition,1);updateCollection(coll);});return true;}
function queryStringToObj(str){var queryString={},str=str;if(str[0]=='!')
str=str.substr(1);str.replace(new RegExp("([^\/^?=&]+)(=([^&]*))?","g"),function($0,$1,$2,$3){queryString[$1]=$3;});return queryString;}
function initializeAwardsTooltip($selector){$selector.tooltip({track:true,tooltipClass:"awards-tooltip",hide:false,position:{my:"center bottom-20",at:"center top",using:function(position,feedback){var $this=$('.ui-tooltip');var elWidth=$this.width();var windowWidth=$(document).width();var arrowLeft;var boundedPos={top:position.top};if(position.left<0){boundedPos.left=0;arrowLeft=50+$this.offset().left+(position.left/2);arrowLeft=arrowLeft<=0?14:arrowLeft;}else if(position.left+elWidth>windowWidth){boundedPos.left=position.left-(position.left+elWidth-windowWidth);arrowLeft=50+100-(boundedPos.left/position.left*100);}else{boundedPos.left=position.left;}
$this.css(boundedPos);var $arrow=$this.find('.tooltip-arrow');$arrow.removeClass('top').removeClass('bottom').addClass(feedback.vertical).addClass(feedback.horizontal).css('left',arrowLeft+'%');if(arrowLeft){$arrow.css('margin-left',0);}}},open:function(event,ui){},content:function(){var $el=$(this);var lockedColor=$el.attr("tooltip-color")||$(".honors-unlocked .honors-box").attr("tooltip-color")||($(this).find('span').hasClass('locked')?"red":"green");return "<div class='tooltip-"+lockedColor+"'>"+$el.attr('title')+"</div>"
+"<div class='tooltip-cont'>"+$el.attr('data-title').split('{br}').join('<br>')+"</div>"
+"<div class='tooltip-arrow'></div>";}});}
function itemInfoHandler(itemInfo,content_class){if(itemInfo.find('.graphs-stock:first').length==0)
return;function chechWidth(){var $graphs=itemInfo.find('.graphs-stock'),$circ=$($graphs[1]),$val=$($graphs[0]),circ_w=25,val_w=25;$circ.children().each(function(index,item){if(index<3)
circ_w+=$(item).width();});if(circ_w>$circ.width()||getBrowserWidth()<minTabletSize)
$circ.find('.title').text('Circ:');$val.children().each(function(index,item){if(index<3)
val_w+=$(item).width();});if(val_w>$val.width())
$val.find('.title').text('Val:');}
chechWidth();if(content_class){itemInfo.find('.chart-main-wrap').addClass(content_class);var gridBG='#202020';}
var bookInfo=itemInfo.find('.book-info .hover');if(bookInfo){bookInfo.colorbox({transition:'none',href:bookInfo.data('url'),photo:true,scalePhotos:false,maxWidth:'100%',onComplete:function(){}});}
itemInfo.on('click','.graphs-stock',function(event){event.preventDefault();event.stopPropagation();var $this=$(this),$item_info=$this.parents('.info-content:first');$this.parents('.info-cont:first').children().removeClass('bold');$this.addClass('bold');$item_info.find('.tabs-wrap .tab-menu-cont').addClass('hide');var $chart=$item_info.find('.'+$this.attr('chart')).removeClass('hide'),$tab_menu_cont=$item_info.find('.'+$this.attr('chart'));if(!this.wasInit){var itemID=$tab_menu_cont.attr('itemID');$item_info.find('.tabs-wrap').tabs();if(0===$('.chart-main-wrap .without-prettycheckable').length){var $pretty=$item_info.find('.tabs-wrap .'+itemID+' .period-wrap .radio > input');var $prettyFirst=$item_info.find('.tabs-wrap .'+itemID+' .period-wrap .radio > input:not(:disabled)');$pretty.prettyCheckable();$($prettyFirst[0]).prop("checked",true).parent().find("a:first").click();}else{var $periods=$item_info.find('.tabs-wrap .'+itemID+' .period-wrap .radio > input');var $periodsFirst=$item_info.find('.tabs-wrap .'+itemID+' .period-wrap .radio > input:not(:disabled)');$($periodsFirst[0]).prop("checked",true);var $secondPeriods=$('.period-wrap.ui-tabs-nav .radio');var $uniqueId=$($secondPeriods[0]).find('input.radio-css[id$=second]');if(0===$uniqueId.length){$.map($secondPeriods,function(period){var $inputPeriod=$(period).find('.radio-css');var $labelPeriod=$(period).find('.marker-css');var inputIdValue=$inputPeriod.attr('id')+'-second';$inputPeriod.attr('id',inputIdValue);$labelPeriod.attr('for',inputIdValue);});}}
initialiseChart($item_info.find('.'+itemID+' .chart-placeholder:last'),null,null,null,gridBG);}
this.wasInit=false;});if(0===$('.chart-main-wrap .without-prettycheckable').length){itemInfo.on('click','.period-wrap li.radio',function(event){event.stopPropagation();event.preventDefault();});}
itemInfo.on('change','.period-wrap input:radio',function(event){var $item=$(this).closest('li.radio');updateChart('.'+$item.parents('.tab-menu-cont').attr('itemID')+' .chart-placeholder:last',false,$item.attr('action'),null,gridBG);});if(itemInfo.closest('.rewards-wrap.dark').length>0){itemInfo.find('.period-wrap input.radio-css').addClass('light');}
if($('.main-market-page .buy-item-info-wrap').length>0){if(getBrowserWidth()<minTabletSize){var $inputPeriods=itemInfo.find('input');$.map($inputPeriods,function(period){var labelContent=$(period).data('label');if(labelContent){$(period).closest('li').find('label.marker-css').text(labelContent);}});}}
if(!window.itemInfoWasInit){$(window).resize(function(){chechWidth();});window.itemInfoWasInit=true;}}
function getUserMoney(){var value=0;if($('#user-money')&&$('#user-money').data('money')){var sidebarValue=$('#user-money').data('money');value=sidebarValue;}else if($('#FtcMA .m-hide')&&$('#FtcMA .m-hide').html()){var magicValue=$('#FtcMA .m-hide').html();value=parseInt(magicValue.replace(/\$/,'').replace(/,/g,''));}
return value;}
function isOperaMini(){return(navigator.userAgent.indexOf('Opera Mini')>-1);}
function twf(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}
function numberFormat(num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");}
function ieVersion(){var ua=window.navigator.userAgent;if(ua.indexOf("Trident/7.0")>0)
return 11;else if(ua.indexOf("Trident/6.0")>0)
return 10;else if(ua.indexOf("Trident/5.0")>0)
return 9;else
return 0;}
function SoundBtn(element,callback){this.init=function(){if(!element||element.length==0){console.error("SoundBtn error - no node provided");return;}
this.on=this.getLocalValue();this.setState();var self=this;element.on('click',function(e){e.preventDefault();self.on=!self.on;self.setLocalValue();self.setState();if(callback)callback();});};this.setState=function(){if(this.on==true||this.on=='true'){element.addClass('on');}
else{element.removeClass('on');}};this.getLocalValue=function(){var result;if(isLocalStorageAvailable()){result=localStorage.casinoSound;}
else{result=$.cookie('casinoSound');}
return!(result==false||result=='false');};this.setLocalValue=function(){if(isLocalStorageAvailable()){localStorage.casinoSound=this.on;}
else{$.cookie('casinoSound',this.on);}};this.init();}
function getUserDevice(){var device='desktop';if(getBrowserWidth()>minTabletSize&&getBrowserWidth()<=maxTabletSize){device='tablet';}
if(getBrowserWidth()<=minTabletSize){device='mobile';}
return device;}
function setUserDevice(){getAction({type:"post",action:'devicesTypes.php',data:{step:'setDevicesTypeStatistics',device:getUserDevice()},success:function(data){try{var msg=JSON.parse(data);console.info(msg.text);}
catch(err){}},error:function(){console.log('Critical error!');}});}
jQuery(function(){});function getItemSizeByName(name){var sizeArray=[{name:'blank',width:100,height:50},{name:'crimes_blank',width:60,height:30},{name:'large',width:100,height:50},{name:'large_dark',width:100,height:50},{name:'medium',width:60,height:30},{name:'small',width:38,height:19}];return $.grep(sizeArray,function(obj){return obj.name===name;})[0]}
window.changeItemsSizeOff=false;function changeItemsSize($container,nameFrom,nameTo){if(window.changeItemsSizeOff){return}
var size=getItemSizeByName(nameTo);if(size!==undefined){var newItemSizeClass='items'+size.width+'x'+size.height;$container.addClass(newItemSizeClass);var imageRegExp=new RegExp('(\\/images\\/items\\/\\d+\\/)?'+nameFrom+'(\\.png){1}(\\?v=\\d+)?','g');$container.find('img').each(function(){var $img=$(this);var currentSrc=$img.attr('src');var newSrc=currentSrc.replace(imageRegExp,function(str,$1,$2){return $1+nameTo+$2;});if(currentSrc!=newSrc){$img.attr('src',newSrc);}});}}
var getUserData=function(callback){};var getAFBA=function(){};function getRecaptchaV3Token(actionName){return new Promise(function(resolve,reject){resolve({});});};jQuery(function(){if($.cookie('sidebarStates')){var cookies=$.parseJSON($.cookie('sidebarStates'));if(cookies.isDesktopVersion){$('body').removeClass('r')}}});function copyTextToClipboard(text){function selectElementText(element){var range;if(document.selection){range=document.body.createTextRange();range.moveToElementText(element);range.select();}else if(window.getSelection){range=document.createRange();range.selectNode(element);window.getSelection().removeAllRanges();window.getSelection().addRange(range);}}
var element=document.createElement('div');element.textContent=text;document.body.appendChild(element);selectElementText(element);document.execCommand('copy');element.remove();}
function toggleDesktopMode(){var $body=$('body');$body.toggleClass('r');setSidebarStatesCookie(true);$body.empty();}
$(window).load(function(){var isTouchSupported='ontouchstart'in window,startEvent=isTouchSupported?'touchstart':'mousedown',moveEvent=isTouchSupported?'touchmove':'mousemove',endEvent=isTouchSupported?'touchend':'mouseup';var $body=$('body');$body.on('click','.desktop-version',toggleDesktopMode);var $meta=$('meta[name=viewport]');if(!$body.hasClass('r')){$meta.attr('content','width=device-width, viewport-fit=cover');var htmlTag=document.documentElement;htmlTag.classList.add("html-manual-desktop");}});function setJSCookie(name,value,days){var expires='';value=(value||value==false)?value:'';if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires='; expires='+date.toUTCString();}
document.cookie=name+'='+value+expires+'; path=/';}
function getJSCookie(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length);}}
return null;}
function eraseJSCookie(name){document.cookie=name+'=; Max-Age=-99999999;';}
$(function(){$(".content-title a.travel-home").toggle(function(event){event.preventDefault();getAction({type:"post",action:'travelagency.php',data:{step:'backHome'},success:function(str){$(".travel-home-content").html(str);$(".travel-home-content").removeClass("hide").show();}});},function(event){event.preventDefault();$(".travel-home-content").addClass("hide").hide();});$(".content-wrapper").on("click",".travel-home-content .travel-back-link",function(event){event.preventDefault();getAction({type:"post",action:'travelagency.php',data:{step:'backHomeAction'},success:function(msg){$(".travel-home-content").find(".msg").html(msg);$(".travel-home-content").removeClass("hide");if(!msg.includes('You are currently being attacked')){window.location.href="index.php";}}});});$(".content-wrapper").on("click",".travel-home-content .cancel",function(){$(".content-title a.travel-home").trigger('click');});});function userIsTravelling(){return $('.content-wrapper').hasClass('travelling')&&!$('.computer-frame-wrap').length;}
function preventTextSelectionOnDoubleClick(config){var timerID=null;var invokeType=config.invokeType||'onClick';var containerNode=config.containerNode||document.querySelector('.content-wrapper')||document;var actionNode=config.actionNode||{key:'classList',method:'contains',selector:'btn'};var duaration=config.duaration||300;var preventSelectionNode=config.preventSelectionNode||document;function disableUserSelect(){preventSelectionNode.onselectstart=function(){return false;};}
function activeUserSelect(){preventSelectionNode.onselectstart=function(){return true;};}
function addClickEvent(){containerNode.addEventListener('click',onClickHandler);}
function removeClickEvent(){containerNode.removeEventListener('click',onClickHandler);}
function onClickHandler(e){if(e.target[actionNode.key][actionNode.method]!==actionNode.selector){return;}
startPreventSelection();}
function erashSelectedText(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty();}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges();}}else if(document.selection){document.selection.empty();}}
function startPreventSelection(){if(timerID){timerID=null;}
disableUserSelect();erashSelectedText();timerID=setTimeout(function(){activeUserSelect();invokeType==='callback'&&removeClickEvent();},duaration);};function onClickSelectPrevention(){addClickEvent();}
function callbackSelectPrevention(){startPreventSelection();}
if(invokeType==='callback'){callbackSelectPrevention();return;}
onClickSelectPrevention();};function textAreaValidator(selector,maxLength,maxLineBreaks){if(!selector||!maxLength)return;$(selector).on('input',function(event){var newValue='';var LINE_BREAK_REGEXP=/\r?\n/;if(maxLineBreaks!==undefined){var inputSplit=event.target.value.split(LINE_BREAK_REGEXP);newValue=inputSplit.length>=maxLineBreaks?inputSplit.slice(0,maxLineBreaks).join('\n'):'';}
if(event.target.value.length>maxLength){newValue=inputSplit.slice(0,maxLength);}
$(this).val(newValue||event.target.value);});}
var fullwidth=window.screen.availWidth;var width=window.screen.availWidth/3;var leftpos=fullwidth-width;var height=window.screen.availHeight;function win(url){helpwin=window.open('','Torn Help Wiki','scrollbars=yes,toolbar=no,resizeable=no,status=no,width='+width+',height='+height+',top=0,left='+leftpos+',directores=no');helpwin.location.href=url;}
$(document).ready(function(){$body=$('body');$body.on('submit','form',function(event){var isReCaptcha=$(this).find('.btn-wrap .torn-btn[name!="reCaptcha"]').length;var isSubmitButton=!$(this).find('.btn-wrap .torn-btn').hasClass('submit-btn');var isEditor=$(this).find('button').length;if(isReCaptcha&&isEditor&&isSubmitButton){event.preventDefault();event.stopPropagation();}});$body.on('click','.btn-wrap.disable .torn-btn',function(event){event.preventDefault();});$body.on('click','.torn-btn:disabled',function(event){event.preventDefault();});$body.on('click','a[href="#"].wai-support',function(event){event.preventDefault();});$('[data-wai-label]').each(function(){var ariaLabel=$(this).attr('aria-label')||'';if(this.textContent){$(this).attr('aria-label',ariaLabel+' '+this.textContent.replace(/\s+/g,' '));}});function optimizeUserIconsTooltipsForTouchscreens(){function iOSVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var v=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(v[1],10),parseInt(v[2],10),parseInt(v[3]||0,10)];}}
if(iOSVersion()&&iOSVersion()[0]<13)return;var iconsSelector='.big [id^="icon"] a, .med [id^="icon"] a, .sml [id^="icon"] a';var clickedIcon;$(document).on('click',iconsSelector,function(e){if(!isTouchDevice())return;if(this!==clickedIcon){e.preventDefault();clickedIcon=this;}})}
optimizeUserIconsTooltipsForTouchscreens();if(typeof itemsConverter==='object'){itemsConverter.init({selector:'img.torn-item'});}});