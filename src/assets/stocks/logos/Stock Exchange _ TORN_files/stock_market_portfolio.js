function initPortfolio(){function init(){var $chartsCollection=$('.chart-placeholder'),$content_wrapper=$('.content-wrapper');$chartsCollection.each(function(index){var id='chart-placeholder'+index;$(this).attr('id',id);initialiseChart('#'+id+'.chart-placeholder',null,null,true);});function blockStateDefault(){var $stockContainer=$('.stock-main-wrap .stock-cont');$stockContainer.find('.item-action').hide();$stockContainer.find('.item-wrap').removeClass('active sell');};$('.stock-main-wrap .item-wrap .split').click(function(event){event.preventDefault();if(!$(this).find('.torn-btn').prop('disabled')){var $itemInstance=$(this).parents('.item-wrap');blockStateDefault();$itemInstance.find('.split-wrap').show();$itemInstance.addClass('active');}});$('.stock-main-wrap .item-wrap .stack').click(function(event){event.preventDefault();var $itemInstance=$(this).parents('.item-wrap');var $stockContainer=$('.stock-main-wrap .stock-cont');var companyName=$itemInstance.attr('data-stock');blockStateDefault();$stockContainer.find("[data-stock='"+companyName+"']:not(.remove)").addClass('active');$itemInstance.find('.stack-wrap').show();});$('.stock-main-wrap .item-wrap .logo a').click(function(event){event.preventDefault();var $itemInstance=$(this).parents('.item-wrap');var $stockContainer=$('.stock-main-wrap .stock-cont');if($itemInstance.find('.profile-wrap').is(':visible')){$stockContainer.find('.profile-wrap').hide();}
else{blockStateDefault();$itemInstance.find('.profile-wrap').show();}
var $header=$(event.currentTarget);if(event.currentTarget.wasClicked){var action=$header.attr('href').split('?'),params=queryStringToObj(action[1]);ajaxWrapper({url:action[0]+'?step=updateMoney&ID='+params.ID,type:'POST',oncomplete:function(resp){var data=JSON.parse(resp.responseText);$itemInstance.find('.buy-wrap .left').find('input[name-amount]').val(Math.floor(data.monet/data.price));$itemInstance.find('.buy-wrap .right').find('input[name-amount]').val(data.monet);}});return;}
event.currentTarget.wasClicked=true;var $tab_wrapper=$itemInstance.find('.profile-wrap:first');$tab_wrapper.html('<img class="ajax-placeholder m-top10 m-bottom10" src="/images/v2/main/ajax-loader.gif" />');if($header.attr('href')){ajaxWrapper({url:$header.attr('href'),oncomplete:function(resp){$tab_wrapper.html(resp.responseText);initProfile($tab_wrapper);}});}});$('.stock-main-wrap .item-wrap .logo img').click(function(event){event.preventDefault();$(this).parents('.item-wrap').find('a.profile').trigger('click');});$('.stock-main-wrap .item-wrap .cancel').click(function(){blockStateDefault();});$('.stock-main-wrap a.ajax-action').click(function(event){event.preventDefault();var $this=$(this),obj=queryStringToObj($this.attr('href').split('?')[1]);actions[obj.step]($this,obj);});$('.stock-main-wrap .sell').click(function(event){event.preventDefault();var $parent=$(this).closest('.item-wrap');$parent.find('.cancel').click();$parent.toggleClass('sell');});$('.stock-main-wrap .sell-wrap .no').click(function(event){event.preventDefault();$(this).closest('.item-wrap').removeClass('sell');});$('.stock-main-wrap .remove-wrap .remove').click(function(){$(this).closest('.remove-wrap').addClass('confirm');});$('.stock-main-wrap .remove-wrap .no, .stock-main-wrap .remove-wrap .yes').click(function(){$(this).closest('.remove-wrap').removeClass('confirm');});$('.stock-main-wrap form.ajax-action').submit(function(event){event.preventDefault();var $this=$(this);actions['formSubmit']($this,null,$this.serializeArray());});$('.stock-main-wrap .input-wrap .btn').click(function(){var isDisabled=$(this).find('.torn-btn').prop('disabled');if(!isDisabled){$(this).parents('form:first').submit();}});initSorting();$('.split-wrap input[name="amount"]').each(function(){var $el=$(this);$el.tornInputMoney({buttonElement:$el.closest('.input-wrap').find('.torn-btn')});});}
init();var $content_wrapper;var $computerContentWrapper=$('#computer-content-wrapper');if($computerContentWrapper.length>0){$content_wrapper=$computerContentWrapper;}else{$content_wrapper=$('.content-wrapper:first');}
var $infoWrapper=$('#info_wrapper'),actions={sell:function($this,queryObject){ajaxWrapper({url:$this.attr('href'),type:'POST',oncomplete:function(resp){var data=JSON.parse(resp.responseText);if(data.success){$this.parents('li.item-wrap').removeClass('sell').addClass('remove');}
if(data.timeMsg){$this.closest('li.item-wrap').find('.time-wrap').text(data.timeMsg);}}},{elementIn:$infoWrapper,isTopDelimiterRequired:false,isBottomDelimiterRequired:true});},unsell:function($this,queryObject){ajaxWrapper({url:$this.attr('href'),type:'POST',oncomplete:function(resp){var data=JSON.parse(resp.responseText);if(data.success){$this.parents('li.item-wrap').removeClass('remove');}}},{elementIn:$infoWrapper,isTopDelimiterRequired:false,isBottomDelimiterRequired:true});},formSubmit:function($this,queryObject,paramsObj){$content_wrapper.html('<img class="ajax-placeholder m-top10 m-bottom10" src="/images/v2/main/ajax-loader.gif" />');ajaxWrapper({url:$this.attr('action'),type:'POST',data:paramsObj?paramsObj:$this.serializeArray(),oncomplete:function(resp){$content_wrapper.html(resp.responseText);init();}});}}
function initSorting(){sortingSharesList();}
function sortingSharesList(){var $list=$('.portfolio-list-shares');var $window=$(window);var windowHeight=$window.height();$list.sortable({helper:'clone',containment:'parent',tolerance:'pointer',handle:'.draggable-icon',scroll:true,sort:function(event,ui){sortableScrollHack(event,ui);},update:function(event,ui){var data=$list.find('> li').map(function(){return this.id}).get();ajaxWrapper({url:$list.attr('action'),type:'POST',data:{shares:data},oncomplete:function(resp){}});}});$('.stock-main-wrap .stock-cont .draggable-icon').disableSelection();}}
jQuery(function(){initPortfolio();});