var $content_wrapper;$(function(){window.template=Handlebars.templates['buy_result'];var $computerContentWrapper=$('#computer-content-wrapper');if($computerContentWrapper.length>0){$content_wrapper=$computerContentWrapper;}else{$content_wrapper=$('.content-wrapper:first');}});document.addEventListener('onMoneyChange',function(){getAction({type:"post",action:'inputMoneyAction.php?step=generalAction',success:function(moneyOnHand){var $stockList=$('.stock-list');var $sharesAmountInputsList=$stockList.find('input[type="text"].shares-amount-input');var $investAmountInputsList=$stockList.find('input[type="text"].invest');$sharesAmountInputsList.each(function(index,input){var $input=$(input);var stockPrice=$input.parents('.item').find('.price').text().split('$').pop().replace(',','');var sharesAmount=Math.floor(moneyOnHand/stockPrice);$input.attr('data-money',sharesAmount);$input.siblings('.shares-amount-input').attr('data-money',sharesAmount);});$investAmountInputsList.attr('data-money',moneyOnHand);}});});var isInitTabsCategorySelect=false;var switcherBuyBlocks=function(buyStockContainer,turnOn){var $buyWrap=buyStockContainer.parents('.column-wrap');var $input=$buyWrap.find('.input-wrap input');var $buttonContinue=$buyWrap.find('.continue .torn-btn');var $label=$buyWrap.find('.label');if(turnOn){$input.removeAttr('readonly');$buttonContinue.prop('disabled',false);$label.removeClass('disable');$buyWrap.find('.input-wrap').show();$buyWrap.find('.success-wrap').hide();$buyWrap.find('.error-wrap').hide();}
else{$input.attr('readonly','readonly');$buttonContinue.prop('disabled',true);$label.addClass('disable');}};var initProfile=function($tab_wrapper){$tab_wrapper.tabs({active:0});var $inputSharesAmount=$tab_wrapper.find('.shares-amount-input');var $buttonShares=$inputSharesAmount.closest('.buy-wrap').find('.btn-wrap.continue .torn-btn');var $inputInvest=$tab_wrapper.find('input[name="amount"].invest');var $buttonInvest=$inputInvest.closest('.buy-wrap').find('.btn-wrap.continue .torn-btn');$inputSharesAmount.tornInputMoney({buttonElement:$buttonShares,showSymbolButton:false});$inputInvest.tornInputMoney({buttonElement:$buttonInvest,ajaxAction:"inputMoneyAction.php?step=generalAction"});var tabsCategory='';$tab_wrapper.find('.tabs-category').each(function(){tabsCategory=$tab_wrapper.closest('.item-wrap').data('stock');$(this).attr('id',tabsCategory);$(this).siblings('.select-list').addClass(tabsCategory);var $tabsCategory=$(this);$tabsCategory.change(function(){var tabId=$(this).val();$('.stock-tabs').find('a[href="#'+tabId+'"]').click();});initDropdown($tabsCategory,tabsCategory,{width:'100%',scrollHeight:'200'});});$tab_wrapper.find('.big-select-menu-wrap .select-wrap').fadeIn(1500);$tab_wrapper.find('form').submit(function(event){event.preventDefault();var $form=$(this),$btn=$form.find('.continue .torn-btn');if(!$btn.prop('disabled')){var $buyBlock=$(this).parents('.buy-wrap');$buyBlock.find('.input-wrap').hide();$buyBlock.find('.loader-wrap').show();var $input=$form.find('[name="amount"]');if(!isNumber($input.val())&&isPrettyNumber($input.val())){$input.val(parsePrettyNumberToInt($input.val()));}
ajaxWrapper({url:$form.attr('action'),type:'POST',data:$form.serializeArray(),oncomplete:function(resp){var result=JSON.parse(resp.responseText);var html=template(result);var tempResultBuyAjax=result.result;if(tempResultBuyAjax){$buyBlock.find('.success-wrap').html(html).show();}
else{$buyBlock.find('.error-wrap').html(html).show();}
$buyBlock.find('.loader-wrap').hide();switcherBuyBlocks($buyBlock,false);}});}});$tab_wrapper.find('form .continue').click(function(event){event.stopPropagation();});$tab_wrapper.on('click','.success-wrap .stock-yes',function(){var $buyBlock=$(this).parents('.buy-wrap');$content_wrapper.html('<img class="ajax-placeholder m-top10 m-bottom10" src="/images/v2/main/ajax-loader.gif" />')
var action=$(this).attr('action');ajaxWrapper({url:action,type:'POST',oncomplete:function(resp){var obj=queryStringToObj(action);$content_wrapper.html(resp.responseText);if(obj.portfolio=='true')
initPortfolio();else
initStockAccordion();}})});$tab_wrapper.on('click','.success-wrap .stock-no, .buy-wrap .stock-okay',function(){var $buyBlock=$(this).parents('.buy-wrap');switcherBuyBlocks($buyBlock,true);});$tab_wrapper.find('.graphs-stock a').click(function(){var graphsStockId=$(this).attr('href'),$graphsStockId=$(graphsStockId);if(!$graphsStockId.attr('prettyprettyCheckableInit')){$graphsStockId.attr('prettyprettyCheckableInit',true);}
initialiseChart(graphsStockId+' .chart-placeholder');});$tab_wrapper.find('.period-wrap .radio').click(function(){$(this).find('input.radio-css').prop('checked',true);updateChart('#'+$(this).parents('.graphs-stock-wrap').attr('id')+' .chart-placeholder',false,$(this).attr('action'));});isInitTabsCategorySelect=false;profileOnResize($tab_wrapper);}
var profileOnResize=function($el){if(getBrowserWidth()<=maxTabletSize){if($el.hasClass('.ui-tabs'))
var activeTabIndex=$el.tabs("option","active");var $categorySelectInstance=$(this).find('.tabs-category');var $optionsSelect=$categorySelectInstance.find('option');$optionsSelect.eq(activeTabIndex).attr('selected','selected');$categorySelectInstance.selectmenu({itemIcons:true});$el.find('.ui-selectmenu-menu-dropdown').each(function(){$(this).find('a').prepend('<i class="select-icon"></i>');});$el.find('.ui-selectmenu-status').prepend('<i class="select-icon"></i>');}}