$(document).ready(function(){var sliderContainer=document.getElementById('header-swiper-container');if(sliderContainer){function NewsTicker(){var self=this;var SLIDER_INTERVAL=15000;var activeSlide=0;this.container=sliderContainer;this.wrapper=document.getElementById('news-ticker-slider-wrapper');this.$wrapper=$(this.wrapper);this.canToggleHeadline=false;var newsCount=this.wrapper.getElementsByClassName('news-ticker-slide').length;var SLIDE_HEIGHT=$(this.wrapper).find('.news-ticker-slide').height();var NEWS_TICKER_COOKIE_NAME='newsTicker';var NEWS_TICKER_HIDDEN_DESKTOP='newsTickerHiddenDesktop';var NEWS_TICKER_HIDDEN_MOBILE='newsTickerHiddenMobile';var NEWS_TICKER_IS_ENABLED='newsTickerIsEnabled';var YEAR=365;var SECONDS_IN_HOUR=3600;var SECONDS_IN_MINUTE=60;var HOURS_IN_DAY=24;var SLIDE_ANIMATION_DURATION=500;var SLIDES_LIMIT=10;var timerID,leftTime;var isEnabled=($.cookie(NEWS_TICKER_IS_ENABLED)&&!!$.cookie(NEWS_TICKER_IS_ENABLED))||true;this.startInterval=function(){timerID=setInterval(function(){try{if(!document.hidden){self.slideNext();}}catch(error){console.log(error)}},SLIDER_INTERVAL)};this.preventClicksOnEmptyLinks=function(){$(self.container).on('click','a',function(e){if($(this).attr('href')==='#'){e.preventDefault();}})};this.preventClicksOnEmptyLinks();this.removeOldNewsTickers=function(){var removeElements=$(self.wrapper).find('.news-ticker-slide').slice(0,activeSlide);var countRemovedElements=removeElements.length;$(removeElements).remove();activeSlide-=countRemovedElements;$(self.wrapper).css('marginTop','-'+activeSlide*SLIDE_HEIGHT+'px');self.setActiveSlideClass();};this.slideNext=function(){if(newsCount<=1){self.loadNews();}
var $activeHeadline=$('.news-ticker-slide-active');var hasUrgent=$('.announcement');var isUrgentActiveHeadline=$activeHeadline.hasClass('announcement');if(newsCount>1){if(hasUrgent.length&&!isUrgentActiveHeadline){$('.news-ticker-slide:not(".announcement")').remove();$(self.wrapper).css('margin-top','-'+0+'px');$('.news-ticker-slide').first().addClass('news-ticker-slide-active');activeSlide=0;newsCount=this.wrapper.getElementsByClassName('news-ticker-slide').length;}else{activeSlide++;$(self.wrapper).animate({marginTop:'-='+SLIDE_HEIGHT+'px'},SLIDE_ANIMATION_DURATION,function(){self.mobileView();if(newsCount===activeSlide+1){self.loadNews();}});self.setActiveSlideClass();self.setDataToCookie();}}};this.setActiveSlideClass=function(){$(self.wrapper).find('.news-ticker-slide').removeClass('news-ticker-slide-active').eq(activeSlide).addClass('news-ticker-slide-active');};this.loadNews=function(e){var $activeSlide=$($(self.wrapper).find('.news-ticker-slide').get(activeSlide));var newsTickerJSON=$.cookie(NEWS_TICKER_COOKIE_NAME)&&JSON.parse($.cookie(NEWS_TICKER_COOKIE_NAME));var isDonationHeadline=$activeSlide.attr('data-type')==='donation';var activeHeadlineVal=isDonationHeadline?newsTickerJSON.activeHeadlineID:$activeSlide.attr('data-id');var activeHeadlineTypeVal=isDonationHeadline?newsTickerJSON.activeHeadlineType:$activeSlide.attr('data-type');self.canToggleHeadline=true;getAction({action:'/page.php?sid=newsTickers',type:'post',data:{limit:SLIDES_LIMIT,isManualMode:!!e,newsTickerActiveHeadline:activeHeadlineVal,newsTickerActiveHeadlineType:activeHeadlineTypeVal},success:function(resp){if(resp.headlines&&resp.headlines.length){var firstElementID=$($(self.wrapper).find('.news-ticker-slide').get(0)).attr('data-id');if(newsCount!==1||parseInt(firstElementID,10)!==resp.headlines[0].ID){self.addNews(resp.headlines);newsCount=resp.headlines.length+1;self.removeOldNewsTickers();}}else{clearInterval(timerID);}
self.canToggleHeadline=false;}})};this.handleTogglingSlides=function(e){var $slides=$(self.wrapper).find('.news-ticker-slide');var firstElementID=$($slides.get(0)).attr('data-id');var sameElements=true;if(isEnabled){if(!self.canToggleHeadline){$slides.each(function(index,el){var elementID=$(el).attr('data-id');if(elementID!==firstElementID){sameElements=false;return false;}});if(newsCount===1||sameElements){self.loadNews(e);}else{self.canToggleHeadline=true;activeSlide++;$(self.wrapper).animate({marginTop:'-='+SLIDE_HEIGHT+'px'},SLIDE_ANIMATION_DURATION,function(){clearInterval(timerID);self.startInterval();self.canToggleHeadline=false;self.mobileView();if(newsCount<=activeSlide+1){self.loadNews(e);}});self.setActiveSlideClass();self.setDataToCookie();}}}};this.handlerScrollHeadlines=function(e){if(isEnabled){if($(e.target).is('div')||$(e.target).is('i')||$(e.target).attr('href')==='#'||$(e.target).parent().attr('href')==='#'){self.handleTogglingSlides(e);}}else{e.preventDefault();}};this.setDataToCookie=function(){var $activeSlide=$('.news-ticker-slide-active');var id=parseInt($activeSlide.attr('data-id'));var type=$activeSlide.attr('data-type');var newsTickerJSON=$.cookie(NEWS_TICKER_COOKIE_NAME)&&JSON.parse($.cookie(NEWS_TICKER_COOKIE_NAME));var newsTickerCookie=newsTickerJSON||{'activeDonationID':null,'activeHeadlineID':id,'activeHeadlineType':type,'headlinesLeft':newsCount-activeSlide};var headlineHTML=$activeSlide.length&&$activeSlide[0].outerHTML;if(headlineHTML){localStorage.setItem('activeHeadline',JSON.stringify(headlineHTML));}
if(type==='donation'){newsTickerCookie={...newsTickerCookie,'activeDonationID':id||newsTickerCookie.activeDonationID}}else{newsTickerCookie={...newsTickerCookie,'activeDonationID':null,'activeHeadlineID':id||newsTickerCookie.activeHeadlineID,'activeHeadlineType':type||newsTickerCookie.activeHeadlineType,}}
newsTickerCookie={...newsTickerCookie,'headlinesLeft':newsCount-activeSlide,};var date=new Date();setCookie('setTime',date.getTime()/1000);setCookie(NEWS_TICKER_COOKIE_NAME,JSON.stringify(newsTickerCookie),YEAR);};this.addNews=function(headlines){if(headlines){var slides=self.getSlides(headlines);$(self.wrapper).append(slides);}};this.generateHeadline=function(headline){var announcementClassName=headline.isGlobal?'announcement':'';var iconClassName;if(headline.type==='donation'){iconClassName='star-icon';}else if(headline.type==='tutorial'){iconClassName='tutorials-icon';}else{iconClassName=headline.isGlobal?'announcement-icon':'news-icon';iconClassName+=headline.type==='faction'?' faction':'';}
var href=headline.link||'#';var $newHeadline=$('<div />',{['class']:'news-ticker-slide '+announcementClassName,['data-id']:headline.ID,['data-type']:headline.type,['data-countdown']:headline.countdown,['data-endtime']:headline.endTime}).append('<div class="left-shadow-box "></div>').append($('<div />',{['class']:'scroll-wrap'}).append($('<i />',{['class']:'icon '+iconClassName})).append($('<a />',{html:headline.headline,href:href}).append($('<span />',{['class']:'news-ticker-countdown',text:headline.formattedCountdown})))).append('<div class="right-shadow-box "></div>');$newHeadline.click(self.handlerScrollHeadlines);return $newHeadline;};this.getSlides=function(headlines){return headlines.map(function(headline){return self.generateHeadline(headline);});};this.startCountdowns=function(){setInterval(function(){self.$wrapper.find('.news-ticker-slide').each(function(index,item){var countdown=parseInt(item.getAttribute('data-countdown'));var endTime=parseInt(item.getAttribute('data-endtime'));if(endTime&&countdown){var serverTime=getCurrentTimestamp()/1000;var secondsLeft=endTime-serverTime;if(secondsLeft){var seconds=--secondsLeft;var days=Math.floor(seconds/(SECONDS_IN_HOUR*HOURS_IN_DAY));seconds-=days*SECONDS_IN_HOUR*HOURS_IN_DAY;var hours=Math.floor(seconds/SECONDS_IN_HOUR);seconds-=hours*SECONDS_IN_HOUR;var minutes=Math.floor(seconds/SECONDS_IN_MINUTE);seconds-=minutes*SECONDS_IN_MINUTE;item.setAttribute('data-countdown',secondsLeft);var countdownEl=item.getElementsByClassName('news-ticker-countdown')[0];if(countdownEl){countdownEl.innerText=formatText(days,hours,minutes,seconds);}}}});},1000);function formatNumber(val){return(val.toString().length<2)?('0'+val):val;}
function formatText(days,hours,minutes,seconds){return '['+
(days!==0?(formatNumber(days)+':'):'')+
(hours!==0?(formatNumber(hours)+':'):'')+
(formatNumber(minutes)+':')+
formatNumber(seconds)+
']';}};this.handlerResize=function(){SLIDE_HEIGHT=$(self.wrapper).find('.news-ticker-slide-active').height();$(self.wrapper).css('margin-top','-'+SLIDE_HEIGHT*activeSlide+'px');};this.synchronizationHeadlines=function(){var isEnabledCookie=$.cookie(NEWS_TICKER_IS_ENABLED);clearInterval(timerID);$("#newsticker-state").attr('checked',isEnabledCookie!=='false');if(isEnabledCookie==='false'){$(self.wrapper).find('.news-ticker-slide').off('click');}else{isEnabled=true;$(self.wrapper).find('.news-ticker-slide').click(self.handlerScrollHeadlines);}
var $slides=$('.news-ticker-slide');var activeHeadline=localStorage.getItem('activeHeadline')&&JSON.parse(localStorage.getItem('activeHeadline'));var newsTickerJSON=$.cookie(NEWS_TICKER_COOKIE_NAME)&&JSON.parse($.cookie(NEWS_TICKER_COOKIE_NAME));var isNotDonationHeadline=newsTickerJSON.activeDonationID===null;var activeId=isNotDonationHeadline?newsTickerJSON.activeHeadlineID:newsTickerJSON.activeDonationID;var activeType=isNotDonationHeadline?newsTickerJSON.activeHeadlineType:'donation';var $activeHeadline=$(self.wrapper).find("[data-id='"+activeId+"'][data-type='"+activeType+"']");var scrollCss;var activeSlide;if($slides.length){if($activeHeadline&&$activeHeadline.length){self.setActiveSlideClass();}else{$slides.remove();$(self.wrapper).prepend(activeHeadline);newsCount=1;$activeHeadline=$(self.wrapper).find("[data-id='"+activeId+"'][data-type='"+activeType+"']");}
activeSlide=$slides.index($activeHeadline);scrollCss=SLIDE_HEIGHT*activeSlide;$(self.wrapper).css('margin-top','-'+scrollCss+'px');if(isEnabledCookie!=='false'){$(self.wrapper).find('.news-ticker-slide').click(self.handlerScrollHeadlines);}
if(newsCount===1){self.loadNews();}
self.startInterval();}};this.mobileView=function(){var $activeHeadline=$('.news-ticker-slide-active');var $scrollWrap=$activeHeadline.find('.scroll-wrap');var $link=$scrollWrap.find('a');var $rightShadowBox=$activeHeadline.find('.right-shadow-box');var scrollWidthScrollWrap;if($link&&$link.get(0)){if($link.get(0).offsetWidth<$link.get(0).scrollWidth){$rightShadowBox.addClass('active');$activeHeadline.on('touchmove',function(){clearInterval(timerID);$($scrollWrap).scroll(function(){var newScrollLeft=$scrollWrap.scrollLeft(),width=$scrollWrap.width(),scrollWidth=$scrollWrap.get(0).scrollWidth;if(scrollWidth-newScrollLeft-width===0){$rightShadowBox.removeClass('active');$scrollWrap.addClass('mg10');}});});$activeHeadline.on('touchend',function(){if($scrollWrap.get(0)){scrollWidthScrollWrap=$scrollWrap.get(0).scrollWidth;}
$('.scroll-wrap').animate({scrollLeft:"-="+scrollWidthScrollWrap+"px"},1000,function(){clearInterval(timerID);self.startInterval();$('.scroll-wrap').removeClass('mg10');$rightShadowBox.addClass('active');});});}}};this.toggleNewsTickerVisibilityMobile=function(){var $newsTicker=$(sliderContainer);$newsTicker.toggleClass('hide-newsticker-mobile');setCookie(NEWS_TICKER_HIDDEN_MOBILE,$newsTicker.hasClass('hide-newsticker-mobile')?1:0);};this.toggleNewsTickerVisibilityDesktop=function(){var $headlines=$(this.wrapper);$headlines.toggleClass('hide-newsticker-desktop');setCookie(NEWS_TICKER_HIDDEN_DESKTOP,$headlines.hasClass('hide-newsticker-desktop')?1:0);};this.setHeadlinesState=function(){var isHiddenDesktop=$.cookie(NEWS_TICKER_HIDDEN_DESKTOP)&&+$.cookie(NEWS_TICKER_HIDDEN_DESKTOP);var isHiddenMobile=$.cookie(NEWS_TICKER_HIDDEN_MOBILE)&&+$.cookie(NEWS_TICKER_HIDDEN_MOBILE);var checkboxState=true;isEnabled=true;if((isDesktopMedia()||isTabletMedia())&&isHiddenDesktop){checkboxState=false;isEnabled=false;}
if(isMobileMedia()&&isHiddenMobile){checkboxState=false;isEnabled=false;}
$("#newsticker-state").attr('checked',checkboxState);setCookie(NEWS_TICKER_IS_ENABLED,isEnabled);};this.setDefaultHeadlinesState=function(){if(!$.cookie(NEWS_TICKER_HIDDEN_DESKTOP)){setCookie(NEWS_TICKER_HIDDEN_DESKTOP,0);}
if(!$.cookie(NEWS_TICKER_HIDDEN_MOBILE)){var $newsTicker=$(sliderContainer);$newsTicker.toggleClass('hide-newsticker-mobile');setCookie(NEWS_TICKER_HIDDEN_MOBILE,1);}};this.checkShowingTimeHeadline=function(){var setTimeCookie=$.cookie().setTime&&JSON.parse($.cookie().setTime);var currentDate=new Date();var currentTime=currentDate.getTime()/1000;var diffTime=(currentTime-setTimeCookie)*1000;if(diffTime>SLIDE_ANIMATION_DURATION){setCookie('setTime',currentTime/1000);self.startInterval();}else{leftTime=setTimeout(function(){self.slideNext();self.setDataToCookie();self.startInterval();},diffTime)}};this.toggleHeadlines=function(){if(isMobileMedia()){self.toggleNewsTickerVisibilityMobile();}else{self.toggleNewsTickerVisibilityDesktop();}
self.setHeadlinesState();if(!isEnabled){$('.news-ticker-slide:not(".announcement")').remove();$('.news-ticker-slide[data-type="faction"]').remove();$(self.wrapper).find('.news-ticker-slide').first().addClass('news-ticker-slide-active');self.setDataToCookie();$(self.wrapper).find('.news-ticker-slide').off('click');}else{$('.news-ticker-slide:not(".news-ticker-slide-active")').remove();$(self.wrapper).find('.news-ticker-slide').click(self.handlerScrollHeadlines);}
$(self.wrapper).css('margin-top','-'+0+'px');activeSlide=0;newsCount=this.wrapper.getElementsByClassName('news-ticker-slide').length;if(newsCount<=1){self.loadNews();}
changeBackdropTopOffset();};this.init=function(){$(self.wrapper).find('.news-ticker-slide').first().addClass('news-ticker-slide-active');self.setDataToCookie();self.checkShowingTimeHeadline();self.setDefaultHeadlinesState();self.setHeadlinesState();self.mobileView();self.preventClicksOnEmptyLinks();self.startCountdowns();$('#newsticker-state').change(function(){self.toggleHeadlines();});$(window).on('resize',function(){self.handlerResize();self.setHeadlinesState();});$(window).on('blur',function(){clearInterval(timerID);});$(window).on('focus',function(){clearInterval(timerID);self.synchronizationHeadlines();});$(self.wrapper).find('.news-ticker-slide').click(self.handlerScrollHeadlines);}}
var newsTicker=new NewsTicker();newsTicker.init();}});